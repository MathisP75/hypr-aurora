!function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["ojs/ojobservable","ojs/ojurlpathadapter","ojs/ojlogger"],function(e,r,o){"use strict";
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
var i,n;r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var s=[],a=function(){for(var t,e=i,r=[];e;)(t=e._activeState)&&r.push({path:t.path||"",params:t.params}),e=e._childRouter;return r};function h(t,o,s){if(o=o||{},this._name="/",this._offset=0,this.beforeStateChange=new e.BehaviorSubject({accept:function(){}}),this.currentState=new e.BehaviorSubject({complete:function(){}}),this._noHistory="skip"===o.history,this._noHistoryOffset=0,this._parentRouter=s,s)this._name=s._name+s._activeState.path+"/",this._offset=s._offset+1,s._noHistory&&(this._noHistoryOffset=s._noHistoryOffset+1);else{if(i)throw Error("Only one root CoreRouter instance may exist at a time");i=this,n=o.urlAdapter||new r,this._setupNavigationListener()}this._configure(t)}return h.prototype._configure=function(t){this._states=[],t&&t.forEach(function(t){var e=t.path,r=e;if("string"==typeof e)r=new RegExp("^"+e+"$");else if(!(e instanceof RegExp))throw Error("Router path must be a string or RegExp");var o={path:e,detail:t.detail,params:{},_match:r,_redirect:t.redirect};this._states.push(o)},this)},h.prototype.sync=function(){var t=this,e=this._getRouteSegment();return this._execute(e||{path:"",params:{}}).then(function(e){var r=e,o=t._childRouter;return o?r=o.sync():t._noHistory||(s=[]),r})},h.prototype._getRouteSegment=function(){var t;this._noHistory?t=s[this._noHistoryOffset]:t=n.getRoutesForUrl()[this._offset];return t},h.prototype.go=function(){var e,r=Array.prototype.slice.call(arguments,0);if(r.forEach(function(r){var o=r.params;o&&Object.keys(o).forEach(function(r){"object"===t(o[r])&&(e=Promise.reject('"params" object may only contain scalar values'))})}),!e){var i=r.map(function(t){return t.path}).join("/"),h=a(),c=n.getUrlForRoutes(h),u=h.slice(0,this._offset).concat(r),p=n.getUrlForRoutes(u);this._noHistory?(o.info("Navigating non-history tracking router(".concat(this._name,") to ").concat(i)),s=s.slice(0,this._noHistoryOffset).concat(r)):c!==p&&(o.info("Navigating router(".concat(this._name,") to ").concat(i)),window.history.pushState(null,"path",p)),e=this.sync()}return e},h.prototype._execute=function(t){var e,r=this._getPendingState(t);return r?(e=this._prepublish(r),this._isCurrentState(r)||(e=e.then(function(){Promise.resolve(!1);return this._publish(r)}.bind(this)))):e=Promise.reject("Router("+this._name+') has no state matching "'+t.path+'"'),e},h.prototype._prepublish=function(t){var e=[];this.beforeStateChange.next({state:t,accept:function(t){e.push(t)}});var r=Promise.all(e).then(function(){return t}),s=this._childRouter;return s&&(r=r.then(function(){return s._prepublish(t)})),r=r.then(function(t){return r!==this._activeSync?Promise.reject():t}.bind(this),function(t){if(r===this._activeSync){o.info("Router sync failed: "+t);var e=function(){for(var t=i,e=[];t;){var r=t._activeState;e.push(r),t=t._childRouter}return n.getUrlForRoutes(e)}();window.history.replaceState(null,"path",e)}return Promise.reject(t)}.bind(this)),this._activeSync=r,r},h.prototype._publish=function(t){var e=[];return this._childRouter=null,this._activeState=t,this.currentState.next({state:t,complete:function(t){e.push(t)}}),Promise.all(e).then(function(){return t})},h.prototype._setupNavigationListener=function(){this===i&&(this._popstateHandler=this.sync.bind(this),window.addEventListener("popstate",this._popstateHandler,!1))},h.prototype._isCurrentState=function(t){var e,r,o=this._activeState;return!!o&&(e=o,r=t,n.getUrlForRoutes([e])===n.getUrlForRoutes([r]))},h.prototype._getPendingState=function(t){var e,r,o=t.path,i=t.params||{};return this._states.some(function(t){return!!t._match.test(o)&&(e=t,!0)}),e&&e._redirect&&(o=e._redirect,e=this._getPendingState({path:o,params:i})),e&&(r={path:o,detail:e.detail,params:i,_match:e._match,_redirect:e._redirect},Object.freeze(r)),r},h.prototype.createChildRouter=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._noHistory&&(e.history="skip");var r=this._activeState;if(!r)throw Error("Router("+this._name+") has no current state. Call sync() on the router first.");if(this._childRouter&&"skip"!==e.history)throw Error("Router("+this._name+") state("+r.path+") already has a child router");var o=new h(t,e,this);return this._childRouter=o,o},h.prototype.destroy=function(){this===i&&(window.removeEventListener("popstate",this._popstateHandler,!1),i=null)},h})}();
//# sourceMappingURL=ojcorerouter.js.map