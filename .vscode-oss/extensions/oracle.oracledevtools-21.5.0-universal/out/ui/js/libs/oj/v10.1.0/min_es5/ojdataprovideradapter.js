!function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=s(e);if(t){var r=s(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return i(this,n)}}function i(t,n){return!n||"object"!==e(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t):n}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["ojs/ojcore-base","ojs/ojdataprovider","ojs/ojmodel","ojs/ojdataprovideradapter-base","ojs/ojeventtarget"],function(e,i,s,o,u){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var l=function(o){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(f,o);var l,c,h,_=r(f);function f(e){var n;return t(this,f),(n=_.call(this,e)).tableDataSource=e,n.FetchByKeysResults=function(){return function e(n,a,r){t(this,e),this._parent=n,this.fetchParameters=a,this.results=r,this[f._FETCHPARAMETERS]=a,this[f._RESULTS]=r}}(),n.ContainsKeysResults=function(){return function e(n,a,r){t(this,e),this._parent=n,this.containsParameters=a,this.results=r,this[f._CONTAINSPARAMETERS]=a,this[f._RESULTS]=r}}(),n.Item=function(){return function e(n,a,r){t(this,e),this._parent=n,this.metadata=a,this.data=r,this[f._METADATA]=a,this[f._DATA]=r}}(),n.FetchByOffsetResults=function(){return function e(n,a,r,i){t(this,e),this._parent=n,this.fetchParameters=a,this.results=r,this.done=i,this[f._FETCHPARAMETERS]=a,this[f._RESULTS]=r,this[f._DONE]=i}}(),n.FetchListParameters=function(){return function e(n,a,r){t(this,e),this._parent=n,this.size=a,this.sortCriteria=r,this[f._SIZE]=a,this[f._SORTCRITERIA]=r}}(),n._addTableDataSourceEventListeners(),n[f._OFFSET]=0,n._ignoreDataSourceEvents=new Array,n}return l=f,(c=[{key:"destroy",value:function(){this._removeTableDataSourceEventListeners()}},{key:"containsKeys",value:function(e){var t=this,n=[];return e[f._KEYS].forEach(function(e){n.push(t.tableDataSource.get(e))}),Promise.all(n).then(function(n){var a=new Set;return n.map(function(e){null!=e&&a.add(e[f._KEY])}),Promise.resolve(new t.ContainsKeysResults(t,e,a))})}},{key:"fetchByKeys",value:function(e){var t=this,n=[];return e[f._KEYS].forEach(function(e){n.push(t.tableDataSource.get(e))}),Promise.all(n).then(function(n){for(var a=new Map,r=0;r<n.length;r++){var i=n[r];if(null!=i){var s=i[f._KEY],o=i[f._DATA],u=new t.ItemMetadata(t,s);t._extractMetaData(t.dataSource,r,u),a.set(s,new t.Item(t,u,o))}}return Promise.resolve(new t.FetchByKeysResults(t,e,a))})}},{key:"fetchByOffset",value:function(e){var t=this,n=null!=e?e[f._SIZE]:-1,a=null!=e?e[f._SORTCRITERIA]:null,r=null!=e&&e[f._OFFSET]>0?e[f._OFFSET]:0,i=new this.FetchListParameters(this,n,a);return this._startIndex=0,this._getFetchFunc(i,r)(i,!0).then(function(n){var a=n[f._VALUE],r=n[f._DONE],i=a[f._DATA],s=a[f._METADATA].map(function(e){return e[f._KEY]}),o=new Array;i.map(function(e,n){o.push(new t.Item(t,new t.ItemMetadata(t,s[n]),i[n]))});for(var u=0;u<o.length;u++)t._extractMetaData(t.dataSource,u,o[u][f._METADATA]);return new t.FetchByOffsetResults(t,e,o,r)})}},{key:"fetchFirst",value:function(e){return this._isPagingModelTableDataSource()||(this._startIndex=0),new this.AsyncIterable(new this.AsyncIterator(this._getFetchFunc(e),e))}},{key:"getCapability",value:function(e){return e==f._SORT&&"full"==this.tableDataSource.getCapability(e)?{attributes:"multiple"}:"fetchByKeys"==e||"fetchByOffset"==e?{implementation:"lookup"}:null}},{key:"getTotalSize",value:function(){return Promise.resolve(this.tableDataSource.totalSize())}},{key:"isEmpty",value:function(){return this.tableDataSource.totalSize()>0?"no":"yes"}},{key:"getPage",value:function(){return this._isPagingModelTableDataSource()?this.tableDataSource.getPage():-1}},{key:"setPage",value:function(e,t){return this._isPagingModelTableDataSource()?this.tableDataSource.setPage(e,t):Promise.reject(null)}},{key:"getStartItemIndex",value:function(){return this._isPagingModelTableDataSource()?this.tableDataSource.getStartItemIndex():-1}},{key:"getEndItemIndex",value:function(){return this._isPagingModelTableDataSource()?this.tableDataSource.getEndItemIndex():-1}},{key:"getPageCount",value:function(){return this._isPagingModelTableDataSource()?this.tableDataSource.getPageCount():-1}},{key:"totalSize",value:function(){return this._isPagingModelTableDataSource()?this.tableDataSource.totalSize():-1}},{key:"totalSizeConfidence",value:function(){return this._isPagingModelTableDataSource()?this.tableDataSource.totalSizeConfidence():null}},{key:"_getFetchFunc",value:function(e,t){var n=this;if(null!=e&&null!=e[f._SORTCRITERIA]){var a=e[f._SORTCRITERIA][0][f._ATTRIBUTE],r=e[f._SORTCRITERIA][0][f._DIRECTION];return this._ignoreSortEvent=!0,this._isPagingModelTableDataSource()||(this._startIndex=0),function(e,a){return function(r,i){if(i){var s={};return s[f._KEY]=e,s[f._DIRECTION]=a,n[f._OFFSET]=0,n.tableDataSource.sort(s).then(function(){return n._ignoreSortEvent=!1,n._getTableDataSourceFetch(r,t)(r)})}return n._getTableDataSourceFetch(r,t)(r)}}(a,r)}return this._getTableDataSourceFetch(e,t)}},{key:"_extractMetaData",value:function(e,t,n){var a=e;if(this._isPagingModelTableDataSource()&&(a=a.getWrappedDataSource()),a._getMetadata){var r=a._getMetadata(t);r&&Object.keys(r).forEach(function(e){n[e]=r[e]})}}},{key:"_getTableDataSourceFetch",value:function(e,t){var n=this;return function(e,a){var r={};if(t=t>0?t:0,null!=n._startIndex&&(r[f._STARTINDEX]=n._startIndex+t),r[f._PAGESIZE]=null!=e&&e[f._SIZE]>0?e[f._SIZE]:null,!n._isPagingModelTableDataSource()&&e[f._SILENT]&&(r[f._SILENT]=e[f._SILENT]),null!=n.tableDataSource[f._SORTCRITERIA]&&null==e[f._SORTCRITERIA]){e[f._SORTCRITERIA]=[];var i=new n.SortCriterion(n,n.tableDataSource[f._SORTCRITERIA][f._KEY],n.tableDataSource[f._SORTCRITERIA][f._DIRECTION]);e[f._SORTCRITERIA].push(i)}return r[f._FETCHTYPE]=e[f._FETCHTYPE],n._isFetching=!0,new Promise(function(t,a){n._fetchResolveFunc=t,n._fetchRejectFunc=a,n._fetchParams=e,n._requestEventTriggered||(n._isPagingModelTableDataSource()||r[f._SILENT]||n._ignoreDataSourceEvents.push(!0),n.tableDataSource.fetch(r).then(function(a){if(n._isPagingModelTableDataSource()||r[f._SILENT]||n._ignoreDataSourceEvents.pop(),null!==a){n._isFetching=!1,void 0===a&&((a={})[f._KEYS]=[],a[f._DATA]=[]);var i=[];null!=a[f._KEYS]&&(i=a[f._KEYS].map(function(e){return new n.ItemMetadata(n,e)})),null==n._startIndex&&(n._startIndex=0);for(var s=0;s<i.length;s++)n._extractMetaData(n.dataSource,s,i[s]);var o=!1;n._startIndex=n._startIndex+a[f._DATA].length,("actual"==n.tableDataSource.totalSizeConfidence()&&n.tableDataSource.totalSize()>0&&a.startIndex+a[f._DATA].length>=n.tableDataSource.totalSize()||r[f._PAGESIZE]>0&&a[f._DATA].length<r[f._PAGESIZE]||0==a[f._DATA].length)&&(o=!0),n._fetchResolveFunc=null,n._fetchParams=null,t(o?new n.AsyncIteratorReturnResult(n,new n.FetchListResult(n,e,a[f._DATA],i)):new n.AsyncIteratorYieldResult(n,new n.FetchListResult(n,e,a[f._DATA],i)))}},function(e){n._isPagingModelTableDataSource()||r[f._SILENT]||n._ignoreDataSourceEvents.pop(),a(e)}))})}}},{key:"_adjustIteratorOffset",value:function(e,t){var n=this._startIndex,a=0;e&&e.forEach(function(e){e<n&&++a}),n-=a,t&&t.forEach(function(e){e<n&&++n}),this._startIndex=n}},{key:"_handleSync",value:function(e){var t=this;if(!(t._ignoreDataSourceEvents.length>0)){if(t._startIndex=null,e[f._STARTINDEX]>0&&(t._startIndex=e[f._STARTINDEX],t[f._OFFSET]=t._startIndex),t._fetchResolveFunc&&null!=e[f._KEYS]){t._isFetching=!1;for(var n=e[f._KEYS].map(function(e){return new t.ItemMetadata(t,e)}),a=0;a<n.length;a++)t._extractMetaData(t.dataSource,a,n[a]);var r=!1;"actual"==t.tableDataSource.totalSizeConfidence()&&t.tableDataSource.totalSize()>0&&t._startIndex+e[f._DATA].length>=t.tableDataSource.totalSize()&&(r=!0),r?t._fetchResolveFunc(new t.AsyncIteratorReturnResult(t,new t.FetchListResult(t,t._fetchParams,e[f._DATA],n))):t._fetchResolveFunc(new t.AsyncIteratorYieldResult(t,new t.FetchListResult(t,t._fetchParams,e[f._DATA],n))),t._fetchResolveFunc=null,t._fetchParams=null}else t._requestEventTriggered||t.dispatchEvent(new i.DataProviderRefreshEvent);t._requestEventTriggered=!1}}},{key:"_handleAdd",value:function(e){var t,n=this,a=e[f._KEYS].map(function(e){return new n.ItemMetadata(n,e)}),r=new Set;e[f._KEYS].map(function(e){r.add(e)});var s=new n.DataProviderAddOperationEventDetail(n,r,null,null,null,a,e[f._DATA],e[f._INDEXES]),o=new n.DataProviderMutationEventDetail(n,s,null,null);n.dispatchEvent(new i.DataProviderMutationEvent(o)),this._adjustIteratorOffset(null,null===(t=o.add)||void 0===t?void 0:t.indexes)}},{key:"_handleRemove",value:function(e){var t,n=this,a=e[f._KEYS].map(function(e){return new n.ItemMetadata(n,e)}),r=new Set;e[f._KEYS].map(function(e){r.add(e)});var s=new n.DataProviderOperationEventDetail(n,r,a,e[f._DATA],e[f._INDEXES]),o=new n.DataProviderMutationEventDetail(n,null,s,null);n.dispatchEvent(new i.DataProviderMutationEvent(o)),this._adjustIteratorOffset(null===(t=o.remove)||void 0===t?void 0:t.indexes,null)}},{key:"_handleReset",value:function(e){this._requestEventTriggered||this._isPagingModelTableDataSource()||(this._startIndex=0,this.dispatchEvent(new i.DataProviderRefreshEvent))}},{key:"_handleSort",value:function(e){this._ignoreSortEvent||(this._startIndex=null,this.dispatchEvent(new i.DataProviderRefreshEvent))}},{key:"_handleChange",value:function(e){var t=this,n=e[f._KEYS].map(function(e){return new t.ItemMetadata(t,e)}),a=new Set;e[f._KEYS].map(function(e){a.add(e)});var r=new t.DataProviderOperationEventDetail(t,a,n,e[f._DATA],e[f._INDEXES]),s=new t.DataProviderMutationEventDetail(t,null,null,r);t.dispatchEvent(new i.DataProviderMutationEvent(s))}},{key:"_handleRefresh",value:function(e){this._isFetching||this._requestEventTriggered||(null!=e[f._OFFSET]?this._startIndex=e[f._OFFSET]:this._startIndex=null,this.dispatchEvent(new i.DataProviderRefreshEvent)),this._requestEventTriggered=!1}},{key:"_handleRequest",value:function(e){this._ignoreDataSourceEvents.length>0||void 0!==s.Model&&e instanceof s.Model||this._isFetching||(e[f._STARTINDEX]>0&&0==this.getStartItemIndex()&&(this._startIndex=e[f._STARTINDEX]),this._requestEventTriggered=!0,this.dispatchEvent(new i.DataProviderRefreshEvent))}},{key:"_handleError",value:function(e){this._fetchRejectFunc&&this._fetchRejectFunc(e),this._isFetching=!1,this._requestEventTriggered=!1}},{key:"_handlePage",value:function(t){this._isFetching=!1,this._requestEventTriggered=!1;var n={};n.detail=t,this.dispatchEvent(new u.GenericEvent(e.PagingModel.EventType.PAGE,n))}},{key:"_addTableDataSourceEventListeners",value:function(){this.removeAllListeners(),this.addListener("sync",this._handleSync),this.addListener("add",this._handleAdd),this.addListener("remove",this._handleRemove),this.addListener("reset",this._handleReset),this.addListener("sort",this._handleSort),this.addListener("change",this._handleChange),this.addListener("refresh",this._handleRefresh),this.addListener("request",this._handleRequest),this.addListener("error",this._handleError),this.addListener("page",this._handlePage)}},{key:"_removeTableDataSourceEventListeners",value:function(){this.removeListener("sync"),this.removeListener("add"),this.removeListener("remove"),this.removeListener("reset"),this.removeListener("sort"),this.removeListener("change"),this.removeListener("refresh"),this.removeListener("request"),this.removeListener("error"),this.removeListener("page")}},{key:"_isPagingModelTableDataSource",value:function(){return null!=this.tableDataSource.getStartItemIndex}}])&&n(l.prototype,c),h&&n(l,h),f}(o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o);return l._STARTINDEX="startIndex",l._SILENT="silent",l._SORTCRITERIA="sortCriteria",l._PAGESIZE="pageSize",l._OFFSET="offset",l._SIZE="size",l._CONTAINSPARAMETERS="containsParameters",l._RESULTS="results",l._FETCHTYPE="fetchType",u.EventTargetMixin.applyMixin(l),e._registerLegacyNamespaceProp("TableDataSourceAdapter",l),l})}();
//# sourceMappingURL=ojdataprovideradapter.js.map