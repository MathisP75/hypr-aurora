!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["ojs/ojcore-base","ojs/ojmap","ojs/ojset","ojs/ojdataprovider","ojs/ojeventtarget","ojs/ojlogger"],function(e,i,r,a,s,u){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
/**
   * @preserve Copyright 2013 jQuery Foundation and other contributors
   * Released under the MIT license.
   * http://jquery.org/license
   */
var o=function(){function s(e,i){t(this,s),this.data=e,this.options=i,this.Item=function(){return function e(n,i){t(this,e),this.metadata=n,this.data=i,this[s._METADATA]=n,this[s._DATA]=i}}(),this.ItemMetadata=function(){return function e(n){t(this,e),this.key=n,this[s._KEY]=n}}(),this.FetchByKeysResults=function(){return function e(n,i){t(this,e),this.fetchParameters=n,this.results=i,this[s._FETCHPARAMETERS]=n,this[s._RESULTS]=i}}(),this.ContainsKeysResults=function(){return function e(n,i){t(this,e),this.containsParameters=n,this.results=i,this[s._CONTAINSPARAMETERS]=n,this[s._RESULTS]=i}}(),this.FetchByOffsetResults=function(){return function e(n,i,r){t(this,e),this.fetchParameters=n,this.results=i,this.done=r,this[s._FETCHPARAMETERS]=n,this[s._RESULTS]=i,this[s._DONE]=r}}(),this.FetchListParameters=function(){return function e(n,i,r,a){t(this,e),this.size=n,this.sortCriteria=i,this.filterCriterion=r,this.attributes=a,this[s._SIZE]=n,this[s._SORTCRITERIA]=i,this[s._FILTERCRITERION]=r,this[s._ATTRIBUTES]=a}}(),this.FetchListResult=function(){return function e(n,i,r){t(this,e),this.fetchParameters=n,this.data=i,this.metadata=r,this[s._FETCHPARAMETERS]=n,this[s._DATA]=i,this[s._METADATA]=r}}(),this.AsyncIterable=function(){return function e(n){t(this,e),this._asyncIterator=n,this[Symbol.asyncIterator]=function(){return this._asyncIterator}}}(),this.AsyncIterator=function(){function e(n,i,r,a){t(this,e),this._parent=n,this._nextFunc=i,this._params=r,this._offset=a,this._clientId=r&&r.clientId||Symbol(),n._mapClientIdToOffset.set(this._clientId,a),this._cacheObj={},this._cacheObj[s._MUTATIONSEQUENCENUM]=n._mutationSequenceNum}return n(e,[{key:"next",value:function(){var t=this._parent._mapClientIdToOffset.get(this._clientId),e=this._nextFunc(this._params,t,!1,this._cacheObj);return this._parent._mapClientIdToOffset.set(this._clientId,e.offset),Promise.resolve(e.result)}}]),e}(),this.AsyncIteratorYieldResult=function(){return function e(n){t(this,e),this.value=n,this[s._VALUE]=n,this[s._DONE]=!1}}(),this.AsyncIteratorReturnResult=function(){return function e(n){t(this,e),this.value=n,this[s._VALUE]=n,this[s._DONE]=!0}}(),this.DataProviderMutationEventDetail=function(){return function e(n,i,r,a){t(this,e),this._parent=n,this.add=i,this.remove=r,this.update=a,this[s._ADD]=i,this[s._REMOVE]=r,this[s._UPDATE]=a,Object.defineProperty(this,s._PARENT,{value:n,enumerable:!1})}}(),this.DataProviderOperationEventDetail=function(){return function e(n,i,r,a,u){t(this,e),this._parent=n,this.keys=i,this.metadata=r,this.data=a,this.indexes=u,this[s._KEYS]=i,this[s._METADATA]=r,this[s._DATA]=a,this[s._INDEXES]=u,Object.defineProperty(this,s._PARENT,{value:n,enumerable:!1})}}(),this.DataProviderAddOperationEventDetail=function(){return function e(n,i,r,a,u,o,l){t(this,e),this._parent=n,this.keys=i,this.afterKeys=r,this.addBeforeKeys=a,this.metadata=u,this.data=o,this.indexes=l,this[s._KEYS]=i,this[s._AFTERKEYS]=r,this[s._ADDBEFOREKEYS]=a,this[s._METADATA]=u,this[s._DATA]=o,this[s._INDEXES]=l,Object.defineProperty(this,s._PARENT,{value:n,enumerable:!1})}}(),this._cachedIndexMap=[],this._sequenceNum=0,this._mutationSequenceNum=0,this._mapClientIdToOffset=new Map,this._subscribeObservableArray(e),null!=i&&null!=i[s._KEYS]&&(this._keysSpecified=!0,this._keys=i[s._KEYS])}return n(s,[{key:"containsKeys",value:function(t){var e=this;return this.fetchByKeys(t).then(function(n){var i=new r;return t[s._KEYS].forEach(function(t){null!=n[s._RESULTS].get(t)&&i.add(t)}),Promise.resolve(new e.ContainsKeysResults(t,i))})}},{key:"fetchByKeys",value:function(t){var n=this;this._generateKeysIfNeeded();var r,a=new i,u=this._getKeys(),o=null!=t?t[s._ATTRIBUTES]:null,l=0;if(t){var h=n._getRowData();return t[s._KEYS].forEach(function(t){for(r=null,l=0;l<u.length;l++)if(e.Object.compareValues(u[l],t)){r=l;break}if(null!=r&&r>=0){var i=h[r];if(o&&o.length>0){var s={};n._filterRowAttributes(o,i,s),i=s}a.set(t,new n.Item(new n.ItemMetadata(t),i))}}),Promise.resolve(new n.FetchByKeysResults(t,a))}return Promise.reject("Keys are a required parameter")}},{key:"fetchByOffset",value:function(t){var e=this,n=null!=t?t[s._SIZE]:-1,i=null!=t?t[s._SORTCRITERIA]:null,r=null!=t&&t[s._OFFSET]>0?t[s._OFFSET]:0,a=null!=t?t[s._ATTRIBUTES]:null,u=null!=t?t[s._FILTERCRITERION]:null;this._generateKeysIfNeeded();var o=[],l=!0;if(t){var h=new this.FetchListParameters(n,i,u,a),f=this._fetchFrom(h,r,!0).result,c=f[s._VALUE];l=f[s._DONE];var _=c[s._DATA],d=c[s._METADATA].map(function(t){return t[s._KEY]});return o=_.map(function(t,n){return new e.Item(new e.ItemMetadata(d[n]),t)}),Promise.resolve(new this.FetchByOffsetResults(t,o,l))}return Promise.reject("Offset is a required parameter")}},{key:"fetchFirst",value:function(t){return new this.AsyncIterable(new this.AsyncIterator(this,this._fetchFrom.bind(this),t,0))}},{key:"getCapability",value:function(t){return s.getCapability(t)}},{key:"getTotalSize",value:function(){return Promise.resolve(this._getRowData().length)}},{key:"isEmpty",value:function(){return this._getRowData().length>0?"no":"yes"}},{key:"createOptimizedKeySet",value:function(t){return new r(t)}},{key:"createOptimizedKeyMap",value:function(t){if(t){var e=new i;return t.forEach(function(t,n){e.set(n,t)}),e}return new i}},{key:"_getRowData",value:function(){return this[s._DATA]instanceof Array?this[s._DATA]:this[s._DATA]()}},{key:"_getKeys",value:function(){return null==this._keys||this._keys instanceof Array?this._keys:this._keys()}},{key:"_indexOfKey",value:function(t){var n,i=this._getKeys(),r=-1;for(n=0;n<i.length;n++)if(e.Object.compareValues(i[n],t)){r=n;break}return r}},{key:"_adjustIteratorOffset",value:function(t,e){var n=this;this._mapClientIdToOffset.forEach(function(i,r){var a=0;t&&t.forEach(function(t){t<i&&++a}),i-=a,e&&e.forEach(function(t){t<i&&++i}),n._mapClientIdToOffset.set(r,i)})}},{key:"_subscribeObservableArray",value:function(t){if(!(t instanceof Array)){if(!this._isObservableArray(t))throw new Error("Invalid data type. ArrayDataProvider only supports Array or observableArray.");var n=this;t.subscribe(function(t){var i,a,s,o,l,h=[],f=[],c=[],_=[],d=[];n._mutationSequenceNum++;var v=!0,E=!0;t.forEach(function(t){"deleted"===t.status?(v=!1):"added"===t.status&&(E=!1)});var y=[],p=[],T=null,A=null,m=null,R=n._generateKeysIfNeeded();if(!v&&!E){for(i=0;i<t.length;i++){o=t[i].index,l=t[i].status;var I=n._getId(t[i].value);for(a=0;a<t.length;a++)a!=i&&o===t[a].index&&l!==t[a].status&&y.indexOf(i)<0&&p.indexOf(i)<0&&(null==I||e.Object.compareValues(I,n._getId(t[a].value)))&&("deleted"===l?(p.push(i),y.push(a)):(p.push(a),y.push(i)))}for(i=0;i<t.length;i++)if(y.indexOf(i)>=0){var g=n._getKeys()[t[i].index];f.push(g),h.push(t[i].value),c.push(t[i].index)}if(f.length>0){_=f.map(function(t){return new n.ItemMetadata(t)});var O=new r;f.map(function(t){O.add(t)}),T=new n.DataProviderOperationEventDetail(n,O,_,h,c)}}if(h=[],f=[],c=[],!v){for(i=0;i<t.length;i++)"deleted"===t[i].status&&y.indexOf(i)<0&&p.indexOf(i)<0&&(null==(s=n._getId(t[i].value))&&(s=R?t[i].index:n._getKeys()[t[i].index]),f.push(s),h.push(t[i].value),c.push(t[i].index));if(f.length>0&&f.map(function(t){var e=n._indexOfKey(t);e>=0&&n._keys.splice(e,1)}),f.length>0){_=f.map(function(t){return new n.ItemMetadata(t)});var S=new r;f.map(function(t){S.add(t)}),m=new n.DataProviderOperationEventDetail(n,S,_,h,c)}}if(h=[],f=[],c=[],!E){var b=null==n._getKeys()||!(n._getKeys().length>0);for(i=0;i<t.length;i++)"added"===t[i].status&&y.indexOf(i)<0&&p.indexOf(i)<0&&(null==(s=n._getId(t[i].value))&&(R||n._keysSpecified)&&(s=n._getKeys()[t[i].index]),null==s?(s=n._sequenceNum++,n._keys.splice(t[i].index,0,s)):b||-1===n._indexOfKey(s)?n._keys.splice(t[i].index,0,s):R||n._keysSpecified||(u.warn("added row has duplicate key "+s),n._keys.splice(t[i].index,0,s)),f.push(s),h.push(t[i].value),c.push(t[i].index));for(i=0;i<t.length;i++)if("added"===t[i].status&&y.indexOf(i)<0&&p.indexOf(i)<0){var D=n._getKeys()[t[i].index+1];D=null==D?null:D,d.push(D)}if(f.length>0){_=f.map(function(t){return new n.ItemMetadata(t)});var w=new r;f.map(function(t){w.add(t)});var C=new r;d.map(function(t){C.add(t)}),A=new n.DataProviderAddOperationEventDetail(n,w,C,d,_,h,c)}}n._fireMutationEvent(A,m,T)},null,"arrayChange"),t.subscribe(function(t){var e,i,r,s;if(n._mutationEvent){var u=n._mutationEvent.detail;n._adjustIteratorOffset(null===(e=u.remove)||void 0===e?void 0:e.indexes,null===(i=u.add)||void 0===i?void 0:i.indexes),n.dispatchEvent(n._mutationEvent)}else if(n._mutationRemoveEvent||n._mutationAddEvent||n._mutationUpdateEvent){if(n._mutationRemoveEvent){var o=n._mutationRemoveEvent.detail;n._adjustIteratorOffset(null===(r=o.remove)||void 0===r?void 0:r.indexes,null),n.dispatchEvent(n._mutationRemoveEvent)}if(n._mutationAddEvent){var l=n._mutationAddEvent.detail;n._adjustIteratorOffset(null,null===(s=l.add)||void 0===s?void 0:s.indexes),n.dispatchEvent(n._mutationAddEvent)}n._mutationUpdateEvent&&n.dispatchEvent(n._mutationUpdateEvent)}else n.dispatchEvent(new a.DataProviderRefreshEvent);n._mutationEvent=null,n._mutationRemoveEvent=null,n._mutationAddEvent=null,n._mutationUpdateEvent=null},null,"change")}}},{key:"_fireMutationEvent",value:function(t,e,n){var i=new this.DataProviderMutationEventDetail(this,t,e,n);this._mutationEvent=new a.DataProviderMutationEvent(i)}},{key:"_hasSamePropValue",value:function(t,n,i){var r="_hasSamePropValue is true";try{t&&t[i]&&t[i].forEach(function(t){n&&n[i]&&n[i].forEach(function(n){if(e.Object.compareValues(t,n))throw r})})}catch(t){if(t===r)return!0;throw t}return!1}},{key:"_isObservableArray",value:function(t){return"function"==typeof t&&t.subscribe&&!(void 0===t.destroyAll)}},{key:"_generateKeysIfNeeded",value:function(){if(null==this._keys){var t=null!=this.options?this.options[s._KEYATTRIBUTES]||this.options[s._IDATTRIBUTE]:null;this._keys=[];var e,n=this._getRowData(),i=0;for(i=0;i<n.length;i++)null!=(e=this._getId(n[i]))&&"@index"!=t||(e=this._sequenceNum++),this._keys[i]=e;return!0}return!1}},{key:"_getId",value:function(t){var e,n=null;if(null!=this.options&&(null!=this.options[s._KEYATTRIBUTES]?n=this.options[s._KEYATTRIBUTES]:null!=this.options[s._IDATTRIBUTE]&&(n=this.options[s._IDATTRIBUTE])),null!=n){var i;if(Array.isArray(n))for(e=[],i=0;i<n.length;i++)e[i]=this._getVal(t,n[i]);else e="@value"==n?this._getAllVals(t):this._getVal(t,n);return e}return null}},{key:"_getVal",value:function(t,e){if("string"==typeof e){var n=e.indexOf(".");if(n>0){var i=e.substring(0,n),r=e.substring(n+1),a=t[i];if(a)return this._getVal(a,r)}}return"function"==typeof t[e]?t[e]():t[e]}},{key:"_getAllVals",value:function(t){var e=this;return Object.keys(t).map(function(n){return e._getVal(t,n)})}},{key:"_fetchFrom",value:function(t,e,n,i){var r=this,u=null!=t?t[s._ATTRIBUTES]:null;this._generateKeysIfNeeded();var o=null!=t?t[s._SORTCRITERIA]:null,l=this._getCachedIndexMap(o,i),h=this._getRowData(),f=l.map(function(t){return h[t]}),c=l.map(function(t){return r._getKeys()[t]}),_=null!=t?t[s._SIZE]>0?t[s._SIZE]:t[s._SIZE]<0?r._getKeys().length:25:25,d=e+_<f.length,v=this._mergeSortCriteria(o);null!=v&&((t=t||{})[s._SORTCRITERIA]=v);var E,y=[],p=[],T=0;if(null!=t&&t[s._FILTERCRITERION]){var A=null;A=a.FilterFactory.getFilter({filterDef:t[s._FILTERCRITERION],filterOptions:this.options});for(var m=0;y.length<_&&m<f.length;)A.filter(f[m])&&(T>=e&&(y.push(f[m]),p.push(c[m])),T++),m++;d=m<f.length}else y=f.slice(e,e+_),p=c.slice(e,e+_);T=e+y.length,E=y.map(function(t){if(u&&u.length>0){var e={};r._filterRowAttributes(u,t,e),t=e}return t});var R=p.map(function(t){return new r.ItemMetadata(t)}),I=new this.FetchListResult(t,E,R);return(n?d:I.data.length>0)?{result:new this.AsyncIteratorYieldResult(I),offset:T}:{result:new this.AsyncIteratorReturnResult(I),offset:T}}},{key:"_getCachedIndexMap",value:function(t,e){if(e&&e.indexMap&&e[s._MUTATIONSEQUENCENUM]===this._mutationSequenceNum)return e.indexMap;var n=this._getRowData().map(function(t,e){return e}),i=this._sortData(n,t);return e&&(e.indexMap=i,e[s._MUTATIONSEQUENCENUM]=this._mutationSequenceNum),i}},{key:"_sortData",value:function(t,e){var n=this._getRowData(),i=t.map(function(t){return{index:t,value:n[t]}});return null!=e&&i.sort(this._getSortComparator(e)),i.map(function(t){return t.index})}},{key:"_getSortComparator",value:function(t){var e=this;return function(n,i){var r,a,u,o,l,h,f=null!=e.options?e.options[s._SORTCOMPARATORS]:null;for(r=0;r<t.length;r++)if(a=t[r][s._DIRECTION],u=t[r][s._ATTRIBUTE],o=null,null!=f&&(o=f[s._COMPARATORS].get(u)),l=e._getVal(n.value,u),h=e._getVal(i.value,u),null!=o){var c="descending"==a?-1:1,_=o(l,h)*c;if(0!=_)return _}else{var d=0,v="string"==typeof l?l:new String(l).toString(),E="string"==typeof h?h:new String(h).toString();if(0!=(d="ascending"==a?v.localeCompare(E,void 0,{numeric:!0,sensitivity:"base"}):E.localeCompare(v,void 0,{numeric:!0,sensitivity:"base"})))return d}return 0}}},{key:"_mergeSortCriteria",value:function(t){var e=null!=this.options?this.options[s._IMPLICITSORT]:null;if(null!=e){if(null==t)return e;var n,i,r,a=t.slice(0);for(n=0;n<e.length;n++){for(r=!1,i=0;i<a.length;i++)a[i][s._ATTRIBUTE]==e[n][s._ATTRIBUTE]&&(r=!0);r||a.push(e[n])}return a}return t}},{key:"_filterRowAttributes",value:function(t,e,n){var i=this;if(Array.isArray(t)){var r,a=!1;t.forEach(function(t){t!=s._ATDEFAULT&&t.name!=s._ATDEFAULT||(a=!0)}),Object.keys(e).forEach(function(s){if(a){var u,o=!1,l=s;for(r=0;r<t.length;r++)if((u=t[r]instanceof Object?t[r].name:t[r]).startsWith("!")){if((u=u.substr(1,u.length-1))==s){o=!0;break}}else if(u==s){l=t[r];break}o||i._filterRowAttributes(l,e,n)}else t.forEach(function(t){var r;(r=t instanceof Object?t.name:t).startsWith("!")||r!=s||i._filterRowAttributes(t,e,n)})})}else if(t instanceof Object){var u=t.name,o=t.attributes;if(u&&!u.startsWith("!"))if(e[u]instanceof Object&&!Array.isArray(e[u])&&o){var l={};i._filterRowAttributes(o,e[u],l),n[u]=l}else if(Array.isArray(e[u])&&o){var h;n[u]=[],e[u].forEach(function(t,e){h={},i._filterRowAttributes(o,t,h),n[u][e]=h})}else i._proxyAttribute(n,e,u)}else i._proxyAttribute(n,e,t)}},{key:"_proxyAttribute",value:function(t,e,n){t&&e&&Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){e[n]=t},enumerable:!0})}}],[{key:"_getFetchCapability",value:function(){var t=new Set;return t.add("exclusion"),{caching:"all",attributeFilter:{expansion:{},ordering:{},defaultShape:{features:t}}}}},{key:"getCapability",value:function(t){return"sort"==t?{attributes:"multiple"}:"fetchByKeys"==t?Object.assign({implementation:"lookup"},s._getFetchCapability()):"fetchByOffset"==t?Object.assign({implementation:"randomAccess"},s._getFetchCapability()):"fetchFirst"==t?Object.assign({iterationSpeed:"immediate"},s._getFetchCapability()):"fetchCapability"==t?s._getFetchCapability():"filter"==t?{operators:["$co","$eq","$ew","$pr","$gt","$ge","$lt","$le","$ne","$regex","$sw"],attributeExpression:["*"],textFilter:{}}:null}}]),s}();return o._KEY="key",o._KEYS="keys",o._AFTERKEYS="afterKeys",o._ADDBEFOREKEYS="addBeforeKeys",o._DIRECTION="direction",o._ATTRIBUTE="attribute",o._ATTRIBUTES="attributes",o._SORT="sort",o._SORTCRITERIA="sortCriteria",o._FILTERCRITERION="filterCriterion",o._DATA="data",o._METADATA="metadata",o._INDEXES="indexes",o._OFFSET="offset",o._SIZE="size",o._IDATTRIBUTE="idAttribute",o._IMPLICITSORT="implicitSort",o._KEYATTRIBUTES="keyAttributes",o._SORTCOMPARATORS="sortComparators",o._COMPARATORS="comparators",o._COMPARATOR="comparator",o._RESULTS="results",o._CONTAINS="contains",o._FETCHPARAMETERS="fetchParameters",o._CONTAINSPARAMETERS="containsParameters",o._VALUE="value",o._DONE="done",o._ADD="add",o._REMOVE="remove",o._UPDATE="update",o._DETAIL="detail",o._FETCHLISTRESULT="fetchListResult",o._ATDEFAULT="@default",o._MUTATIONSEQUENCENUM="mutationSequenceNum",o._PARENT="_parent",s.EventTargetMixin.applyMixin(o),e._registerLegacyNamespaceProp("ArrayDataProvider",o),o})}();
//# sourceMappingURL=ojarraydataprovider.js.map