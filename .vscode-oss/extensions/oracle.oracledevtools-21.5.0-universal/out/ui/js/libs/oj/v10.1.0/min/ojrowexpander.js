/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojdatasource-common","ojs/ojcore-base","jquery","ojs/ojdomutils","ojs/ojcomponentcore","ojs/ojlogger"],function(t,e,n,s,a,i){"use strict";
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */var o;e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,(o={properties:{context:{type:"object"},expanded:{type:"boolean",writeback:!0},translations:{type:"object",value:{},properties:{accessibleLevelDescription:{type:"string"},accessibleRowCollapsed:{type:"string"},accessibleRowDescription:{type:"string"},accessibleRowExpanded:{type:"string"},accessibleStateCollapsed:{type:"string"},accessibleStateExpanded:{type:"string"}}}},methods:{getProperty:{},refresh:{},setProperties:{},setProperty:{},getNodeBySubId:{},getSubIdByNode:{}},events:{ojCollapse:{},ojExpand:{}},extension:{}}).extension._WIDGET_NAME="ojRowExpander",e.CustomElementBridge.register("oj-row-expander",{metadata:o});
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
const r=function(t,e){this.m_parent=t,this.m_start=e};e._registerLegacyNamespaceProp("EmptyNodeSet",r),r.prototype.getParent=function(){return this.m_parent},r.prototype.getStart=function(){return this.m_start},r.prototype.getCount=function(){return 0},r.prototype.getData=function(t){return null},r.prototype.getMetadata=function(t){return null};
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
const h=function(t,e){this.m_nodeSet=t,this.m_start=e};e._registerLegacyNamespaceProp("FlattenedNodeSet",h),h.prototype.getParent=function(){return this.m_nodeSet.getParent()},h.prototype.getStart=function(){return null!=this.m_start?this.m_start:this.m_nodeSet.getStart()},h.prototype.getCount=function(){return void 0===this.m_count&&(this.m_count=this._getCount(this.m_nodeSet,0),null!=this.m_start&&(this.m_count-=this.m_start)),this.m_count},h.prototype._getCount=function(t,e){var n=e,s=t.getStart(),a=t.getCount();if(n+=a,t.getChildNodeSet)for(var i=0;i<a;i++){var o=t.getChildNodeSet(i+s);null!=o&&(n=this._getCount(o,n))}return n},h.prototype.getData=function(t){return this._getDataOrMetadata(this.m_nodeSet,t,{index:this.m_nodeSet.getStart()},this._getData)},h.prototype.getMetadata=function(t){return this._getDataOrMetadata(this.m_nodeSet,t,{index:this.m_nodeSet.getStart()},this._getMetadata)},h.prototype._getMetadata=function(t,e){return t.getMetadata(e)},h.prototype._getData=function(t,e){return t.getData(e)},h.prototype._getDataOrMetadata=function(t,e,n,s){for(var a=t.getStart(),i=t.getCount(),o=0;o<i;o++){var r=n.index;if(r===e)return s.call(this,t,o+a);if(n.index=r+1,t.getChildNodeSet){var h=t.getChildNodeSet(o+a);if(null!=h){var d=this._getDataOrMetadata(h,e,n,s);if(null!=d)return d}}}return null};
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
const d=function(t,e,n,s){this.m_nodeSet=t,this.m_callback=e,this.m_range=n,this.m_collapsedKeys=s};e._registerLegacyNamespaceProp("NodeSetWrapper",d),d.prototype.getParent=function(){return this.m_nodeSet.getParent()},d.prototype.getStart=function(){return null!=this.m_range?this.m_range.start:this.m_nodeSet.getStart()},d.prototype.getCount=function(){var t=this.m_nodeSet.getStart(),e=this.m_nodeSet.getCount();return null!=this.m_range&&(e=Math.min(this.m_range.count,e),this.m_range.start<t&&(e=0)),e},d.prototype.getData=function(t){return this.m_nodeSet.getData(this._getRelativeIndex(t))},d.prototype.getMetadata=function(t){var e=this.m_nodeSet.getMetadata(this._getRelativeIndex(t));e.index=t,e.parentKey=this.getParent();var n=e.key;return this.m_callback.call(null,n,e),e},d.prototype.getChildNodeSet=function(t){if((null==this.m_collapsedKeys||-1===this.m_collapsedKeys.indexOf(this.m_nodeSet.getMetadata(t).key))&&this.m_nodeSet.getChildNodeSet){var e=this.m_nodeSet.getChildNodeSet(t);if(null!=e)return new d(e,this.m_callback,null,this.m_collapsedKeys)}return null},d.prototype._getRelativeIndex=function(t){return null==this.m_range?t:t-this.m_range.start+this.m_nodeSet.getStart()};
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
const l=function(t,e,n){this.m_nodeSet1=t,this.m_nodeSet2=e,this.m_mergeAt=this._findIndex(n)};e._registerLegacyNamespaceProp("MergedNodeSet",l),l.prototype._findIndex=function(t){for(var e=this.m_nodeSet1.getStart(),n=e+this.m_nodeSet1.getCount(),s=e;s<n;s++){if(t===this.m_nodeSet1.getMetadata(s).key)return s}return n-1},l.prototype.getParent=function(){return this.m_nodeSet1.getParent()},l.prototype.getStart=function(){return this.m_nodeSet1.getStart()},l.prototype.getCount=function(){return this.m_nodeSet1.getCount()+this.m_nodeSet2.getCount()},l.prototype.getData=function(t){var e=this._getRelativeIndex(t),n=e.set,s=e.index;return n.getData(s)},l.prototype.getMetadata=function(t){var e=this._getRelativeIndex(t),n=e.set,s=e.index;return n.getMetadata(s)},l.prototype._getRelativeIndex=function(t){if(t<=this.m_mergeAt)return{set:this.m_nodeSet1,index:t};var e=this.m_nodeSet2.getCount();return t>this.m_mergeAt+e?{set:this.m_nodeSet1,index:t-e}:{set:this.m_nodeSet2,index:t-this.m_mergeAt-1+this.m_nodeSet2.getStart()}};
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
const c=function(t,e){this.m_wrapped=t,this.m_options=e||{},c.superclass.constructor.call(this)};e._registerLegacyNamespaceProp("FlattenedTreeDataSource",c),e.Object.createSubclass(c,e.DataSource,"oj.FlattenedTreeDataSource"),c.prototype.Init=function(){c.superclass.Init.call(this),this.m_wrapped.on("change",this._handleModelEvent.bind(this)),this.m_busy=!1,this.m_fetchSize=parseInt(this.m_options.fetchSize,10),isNaN(this.m_fetchSize)&&(this.m_fetchSize=25),this.m_maxCount=parseInt(this.m_options.maxCount,10),isNaN(this.m_maxCount)&&(this.m_maxCount=500);var t=this.m_options.expanded;Array.isArray(t)?this.m_expandedKeys=t:("all"===t&&(this.m_collapsedKeys=[]),this.m_expandedKeys=[]),this.m_cache=[]},c.prototype.handleEvent=function(t,e){return c.superclass.handleEvent.call(this,t,e)},c.prototype.Destroy=function(){delete this.m_cache,delete this.m_expandedKeys,delete this.m_collapsedKeys,this.m_queue&&delete this.m_queue,this.m_wrapped.off("change"),this.m_wrapped.Destroy&&this.m_wrapped.Destroy()},c.prototype.getFetchSize=function(){return this.m_fetchSize},c.prototype.getMaxCount=function(){return this.m_maxCount},c.prototype.getExpandedKeys=function(){return this.m_expandedKeys},c.prototype.getOption=function(t){return null!=this.m_options?this.m_options[t]:null},c.prototype.getWrappedDataSource=function(){return this.m_wrapped},c.prototype._getFetchSizeToUse=function(t){var e=this.getFetchSize(),n=this.getMaxCount();return-1===e?-1===t?n:t:-1===t?Math.min(e,n):e},c.prototype.fetchRows=function(t,e){this.m_busy=!0,this._isExpandAll()?this._fetchRowsFromDescendants(t,e):this._fetchRowsFromChildren(t,e)},c.prototype._fetchRowsFromChildren=function(t,e){var n;if(t.start>this._getLastIndex()){var s=this._getMaxFetchSize();if(this._getLastIndex()<0)return(n={}).start=t.start,n.count=Math.min(s,t.count),void this.m_wrapped.fetchChildren(null,n,{success:function(s){this._handleFetchSuccess(s,null,0,t,n,0,e)}.bind(this),error:function(t){this._handleFetchError(t,e)}.bind(this)});if(s>0){var a=this._getLastEntry(),i=a.parent,o=this.m_wrapped.getChildCount(i),h=a.index,d=a.depth;if(-1===o||h<o-1){var l=this._getFetchSizeToUse(o);(n={}).start=h+1,n.count=-1===o?Math.min(l,t.count):Math.min(s,Math.min(Math.min(l,t.count),o-n.start)),this.m_wrapped.fetchChildren(i,n,{success:function(s){this._handleFetchSuccess(s,i,d,t,n,o,e)}.bind(this),error:function(t){this._handleFetchError(t,e)}.bind(this)})}else{var c=a.key,p=this.m_wrapped.getChildCount(c);if(!(this._isExpanded(c)&&(-1===p||p>0)?this._fetchFromAncestors(a,d+1,t,e,s):this._fetchFromAncestors(i,d,t,e,s))){var u=new r(null,t.start);null!=e&&null!=e.success&&e.success.call(null,u),this.m_busy=!1}}return}}this.handleMaxCountReached(t,e),this.m_busy=!1},c.prototype.moveOK=function(t,e,n){return this.m_wrapped.moveOK(t,e,n)},c.prototype.move=function(t,e,n,s){this.m_wrapped.move(t,e,n,s)},c.prototype._getMaxFetchSize=function(){return this.getMaxCount()-(this._getLastIndex()+1)},c.prototype._handleFetchError=function(t,e){null!=e&&null!=e.error&&e.error.call(null,t),this.m_busy=!1},c.prototype._handleFetchSuccess=function(t,e,n,s,a,i,o,r){var h=[];this._processNodeSet(t,e,n,h);var l={start:s.start,count:t.getCount()};if(t=new d(t,this.insertMetadata.bind(this),l),0!==h.length){var c=[];c.push(h);var p={};p.callbacks={success:function(t){this._verifyFetchResults(t,e,n,s,a,i,o,r)}.bind(this),error:function(t){this._handleFetchError(t,o)}.bind(this)},p.nodeSet=t,p.keys=[],this._syncExpandRows(c,p)}else this._verifyFetchResults(t,e,n,s,a,i,o,r)},c.prototype._verifyFetchResults=function(t,e,n,s,a,i,o,r){var h,c;if(null!=r){var p=r.prevNodeSet;if(null!=p){var u=p.getStart()+p.getCount()-1,_=p.getMetadata(u).key;h=new l(p,t,_)}}if(t.getCount()<s.count&&null!=e&&n>0){var g={};g.start=s.start+t.getCount(),g.count=s.count-t.getCount();var f={};f.prevNodeSet=null==h?t:h,c=this._fetchFromAncestors(e,n,g,o,void 0,f)}else if(t.getCount()>s.count){var y=t.getCount()-s.count;null!=h?(h=new d(h,this.insertMetadata.bind(this),{start:h.getStart(),count:h.getCount()-y}),this._removeEntry(h.getStart()+h.getCount(),y)):(t=new d(t,this.insertMetadata.bind(this),{start:t.getStart(),count:t.getCount()-y}),this._removeEntry(t.getStart()+t.getCount(),y))}c||null!=o&&null!=o.success&&o.success.call(null,null==h?t:h),this.m_busy=!1},c.prototype.getChildCount=function(t){return this.m_wrapped.getChildCount(t)},c.prototype._fetchFromAncestors=function(t,e,n,s,a,i){var o,r=!1;void 0===a&&(a=this._getMaxFetchSize()),this._isBatchFetching()&&(o={queueOnly:!0});for(var h,d,l,c=this._getFetchSizeToUse(-1),p=this._getLastIndex();p>=0;p--){var u=this._getEntry(p);if((l=u.depth)<e){t=u.parent,h=this.m_wrapped.getChildCount(t);var _=u.index,g=-1===h;if(g||_<h-1){if((d={}).start=_+1,g?(d.count=Math.min(a,Math.max(0,c)),o=void 0):d.count=Math.min(a,Math.min(c,h-d.start)),0===d.count)break;this.m_wrapped.fetchChildren(t,d,{success:function(t,e,a,o,r){this._handleFetchSuccess(r,t,e,n,a,o,s,i)}.bind(this,t,l,d,h),error:function(t){this._handleFetchError(t,s)}.bind(this)},o),r=!0;break}e-=1}}return null!=o&&(this.m_wrapped.fetchChildren(t,{start:n.count,count:0},{success:function(e){this._handleFetchSuccess(e,t,l,n,d,h,s,i)}.bind(this),error:function(t){this._handleFetchError(t,s)}.bind(this)}),r=!0),r},c.prototype._processNodeSet=function(t,e,n,s){for(var a=t.getStart(),i=t.getCount(),o=0;o<i;o++){var r=t.getMetadata(a+o).key;this._addEntry(r,n,a+o,e),this._isExpanded(r)&&s.push(r)}},c.prototype.insertMetadata=function(t,e){this._isExpanded(t)&&!e.leaf?e.state="expanded":e.leaf?e.state="leaf":e.state="collapsed"},c.prototype._fetchRowsFromDescendants=function(t,e){var n={maxCount:this.getMaxCount()};this._getLastIndex()>=0&&(n.start=this._getEntry(this._getLastIndex()).key),this.m_wrapped.fetchDescendants(null,{success:function(n){this._handleFetchDescendantsSuccess(n,t,e)}.bind(this),error:function(t){this._handleFetchError(t,e)}.bind(this)},n)},c.prototype.getSortCriteria=function(){return this.m_wrapped.getSortCriteria()},c.prototype._handleFetchDescendantsSuccess=function(t,e,n){var s,a,i=t;if(e.start>this._getLastIndex()){var o=this._getMaxFetchSize(),l=Math.min(o,e.count);if(i=new d(i,this.insertMetadata.bind(this),null,this.m_collapsedKeys),this._getLastIndex()>=0){var c=this._getLastEntry();s={index:0,found:!1,count:0},this._processDescendantsNodeSet(i,null,0,c,l,s),a=s.index+1}else s={count:0},this._processDescendantsNodeSet(i,null,0,null,l,s),a=0;null!=n&&null!=n.success&&(i=null!=s?0===s.count?new r(null,e.start):new h(i,a):new h(i),n.success.call(null,i))}else this.handleMaxCountReached(e,n);this.m_busy=!1,this._processQueue()},c.prototype._processDescendantsNodeSet=function(t,e,n,s,a,i){for(var o=t.getStart(),r=t.getCount(),h=0;h<r;h++){if(i.count===a)return;var d=t.getMetadata(o+h),l=d.key;if(i.checkDepth&&s.depth>=n&&(i.found=!0,i.checkDepth=!1),(null==s||i.found)&&(this._addEntry(l,n,o+h,e),i.count+=1,d.leaf?d.state="leaf":d.state="expanded"),null==s||i.found||(l===s.key?d.leaf||this._isExpanded(l)?i.found=!0:i.checkDepth=!0:i.index+=1),t.getChildNodeSet&&this._isExpanded(l)){var c=t.getChildNodeSet(h);null!=c&&this._processDescendantsNodeSet(c,l,n+1,s,a,i)}}},c.prototype.expand=function(t){this._expand(t)},c.prototype._expand=function(t,e){this.m_busy=!0;var n=this.m_wrapped.getChildCount(t),s=this._getFetchSizeToUse(n),a=this.getMaxCount();if(this._getLastIndex()+1===a&&this.getIndex(t)===a-1)return void this.handleExpandSuccess(t,new r(t,0),0,e);0!==s?this.m_wrapped.fetchChildren(t,{start:0,count:s},{success:function(s){this.handleExpandSuccess(t,s,n,e)}.bind(this),error:function(e){this.handleExpandError(t,e)}.bind(this)}):this.handleExpandSuccess(t,new r(t,0),0,e)},c.prototype._processQueue=function(){if(this.m_queue&&this.m_queue.length>0){for(var t=this.m_queue.length-1;t>=0;t--){var e=this.m_queue[t];this.collapse(e.key)}this.m_queue.length=0}},c.prototype._queueOp=function(t,e){null==this.m_queue&&(this.m_queue=[]),this.m_queue.push({op:t,key:e})},c.prototype.collapse=function(t){if(this.m_busy)this._queueOp("collapse",t);else{var e=this.getIndex(t)+1,n=this._getEntry(e-1);if(null!=n){for(var s=0,a=n.depth,i=this._getLastIndex(),o=e;o<i+1;o++){var r=this._getEntry(o).depth;if(r>a)s+=1;else if(r===a)break}if(0!==s){this._isExpandAll()?this.m_collapsedKeys.push(t):this._removeExpanded(t);for(var h=[],d=0;d<s;d++)h.push({key:this._getEntry(e+d).key,index:e+d});this._removeEntry(e,s),this.removeRows(h),this.handleEvent("collapse",{rowKey:t})}else this.handleEvent("collapse",{rowKey:t})}}},c.prototype._isExpanded=function(t){return this._isExpandAll()?!(this.m_collapsedKeys&&this.m_collapsedKeys.length>0)||-1===this._getCollapsedKeyIndex(t):!!(this.m_expandedKeys&&this.m_expandedKeys.length>0)&&this._getExpandedKeyIndex(t)>-1},c.prototype._getCollapsedKeyIndex=function(t){return this._getKeyIndex(this.m_collapsedKeys,t)},c.prototype._getExpandedKeyIndex=function(t){return this._getKeyIndex(this.m_expandedKeys,t)},c.prototype._getKeyIndex=function(t,e){for(var n=-1,s=0;s<t.length;s++)t[s]===e&&(n=s);return n},c.prototype._removeExpanded=function(t){var e=this._getExpandedKeyIndex(t);e>-1&&this.m_expandedKeys.splice(e,1)},c.prototype._removeCollapsed=function(t){var e=this._getCollapsedKeyIndex(t);e>-1&&this.m_collapsedKeys.splice(e,1)},c.prototype.handleExpandError=function(t,e){this.handleEvent("expand",{rowKey:t})},c.prototype.handleExpandSuccess=function(t,e,n,s){var a,i;e=new d(e,this.insertMetadata.bind(this));for(var o=this.getIndex(t)+1,r=o,h=e.getStart(),c=e.getCount(),p=this._getEntry(o-1),u=p.depth+1,_=[],g=h;g<c;g++){var f=e.getMetadata(g),y=f.key;this._isExpanded(y)&&_.push(y),this._insertRow(o,f,p.key,g,u),o+=1}if(this._isExpandAll()?this._removeCollapsed(t):-1===this.m_expandedKeys.indexOf(t)&&this.m_expandedKeys.push(t),null!=s&&(a=s.queue,i=s.prevNodeSetInfo),null!=i&&(e=new l(i.nodeSet,e,t)),0===_.length&&(void 0===a||0===a.length)){if(null!=i){var m=i.callbacks;if(null!=m)return m.success.call(null,e),void(this.m_busy=!1);this.insertRows(i.firstIndex,i.firstKey,e)}else this.insertRows(r,t,e);var v=this.getMaxCount();if(-1===n&&c===this.getFetchSize()||n>c||o===v?this._deleteAllRowsBelow(o):this._getLastIndex()>=v&&this._deleteAllRowsBelow(v),null!=i)for(var x=0;x<i.keys.length;x++)this.handleEvent("expand",{rowKey:i.keys[x]});this.m_busy=!1,this.handleEvent("expand",{rowKey:t})}else void 0===a&&(a=[]),_.length>0&&a.push(_),void 0===i&&((i={}).firstIndex=r,i.firstKey=t,i.keys=[]),i.nodeSet=e,i.keys.push(t),this._syncExpandRows(a,i);this.m_busy=!1,a&&0===a.length&&this._processQueue()},c.prototype._syncExpandRows=function(t,e){var n=t[t.length-1],s=n.shift();0===n.length&&t.pop(),this._expand(s,{prevNodeSetInfo:e,queue:t})},c.prototype._insertRow=function(t,e,n,s,a){var i=e.key;t<=this._getLastIndex()?this._addEntry(i,a,s,n,t):this._addEntry(i,a,s,n)},c.prototype._deleteAllRowsBelow=function(t,e){var n=e;null==e&&(n=this._getLastIndex()+1-t);for(var s=[],a=0;a<n;a++)s.push({key:this._getEntry(t+a).key,index:t+a});this._removeEntry(t,n),this.removeRows(s)},c.prototype._handleModelEvent=function(t){var e,n=t.operation,s=t.parent;e=Array.isArray(s)?s[s.length-1]:s;var a=t.index;"insert"===n?this._handleInsertEvent(e,a,t.data):"delete"===n?this._handleDeleteEvent(e,a):"refresh"===n&&this._handleRefreshEvent(e)},c.prototype._handleInsertEvent=function(t,e,n){var s=this.getIndex(t),a=this._getEntry(s).depth+1,i=s+e+1,o=n.getMetadata(n.getStart());this._insertRow(i,o,t,e,a)},c.prototype._handleDeleteEvent=function(t,n){var s=this.getIndex(t),a=this._getEntry(s),i=s+n,o=this._getEntry(i);e.Assert.assert(o.parent===a&&o.depth===a.depth+1);for(var r=i+1,h=this._getLastIndex();r<=h;){if(this._getEntry(r).depth!==o.depth)break;r+=1}this._deleteAllRowsBelow(i,1)},c.prototype._handleRefreshEvent=function(t){null==t&&this.refresh()},c.prototype._isExpandAll=function(){var t=this.m_wrapped.getCapability("fetchDescendants");return null!=this.m_collapsedKeys&&null!=t&&"disable"!==t},c.prototype._isBatchFetching=function(){return"enable"===this.m_wrapped.getCapability("batchFetch")},c.prototype.refresh=function(){this._clearAll()},c.prototype.getIndex=function(t){for(var e=this._getLastIndex(),n=0;n<=e;n++){if(this._getEntry(n).key===t)return n}return-1},c.prototype.getKey=function(t){return t<0||t>this._getLastIndex()?null:this._getEntry(t).key},c.prototype.getFetchedRange=function(){return{start:0,end:this._getLastIndex()+1}},c.prototype.getAncestors=function(t){for(var e=[],n=this.getIndex(t),s=this._getParent(n);null!=s;)e.push(s),n=this.getIndex(s),s=this._getParent(n);return e.reverse()},c.prototype.handleMaxCountReached=function(t,e){null!=e&&null!=e.error&&e.error.call(null)},c.prototype.insertRows=function(t,n,s){e.Assert.failedInAbstractFunction()},c.prototype.removeRows=function(t){e.Assert.failedInAbstractFunction()},c.prototype._getLastIndex=function(){return this.m_cache.length-1},c.prototype._getLastEntry=function(){return this.m_cache[this._getLastIndex()]},c.prototype._getEntry=function(t){return this.m_cache[t]},c.prototype._getParent=function(t){var e=this.m_cache[t];return null!=e?e.parent:null},c.prototype._addEntry=function(t,e,n,s,a){var i={};i.key=t,i.depth=e,i.index=n,i.parent=s,void 0===a?this.m_cache.push(i):this.m_cache.splice(a,0,i)},c.prototype._removeEntry=function(t,e){this.m_cache.splice(t,e)},c.prototype._clearAll=function(){this.m_cache.length=0},c.prototype.getCapability=function(t){return this.m_wrapped.getCapability(t)},
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * as shown at https://oss.oracle.com/licenses/upl/
   * @ignore
   */
e.__registerWidget("oj.ojRowExpander",n.oj.baseComponent,{version:"1.0.0",widgetEventPrefix:"oj",options:{context:null,expanded:null,expand:null,collapse:null},classNames:{root:"oj-rowexpander",icon:"oj-component-icon",clickable:"oj-clickable-icon-nocontext",expand:"oj-rowexpander-expand-icon",collapse:"oj-rowexpander-collapse-icon",leaf:"oj-rowexpander-leaf-icon",lazyload:"oj-rowexpander-lazyload-icon",toucharea:"oj-rowexpander-touch-area",indent:"oj-rowexpander-indent",iconspacer:"oj-rowexpander-icon-spacer",depth0:"oj-rowexpander-depth-0",depth1:"oj-rowexpander-depth-1",depth2:"oj-rowexpander-depth-2",depth3:"oj-rowexpander-depth-3",depth4:"oj-rowexpander-depth-4",depth5:"oj-rowexpander-depth-5",depth6:"oj-rowexpander-depth-6",depth7:"oj-rowexpander-depth-7"},constants:{MAX_STYLE_DEPTH:7,NUM5_KEY:53},_ComponentCreate:function(){this._super(),this.element.addClass(this.classNames.root),this._initContent()},_initContent:function(){var t=this,e=this.options.context;if(null!==e){if(null!=e.component)this.component="function"==typeof e.component?e.component("instance"):e.component;else if(e.componentElement){var s=e.componentElement;s=n(s).hasClass("oj-component-initnode")?s:n(s).find(".oj-component-initnode")[0],this.component=a.__GetWidgetConstructor(s)("instance")}this.datasource=e.datasource,this._isDataProvider()&&this._subscribeToDataProvider(),this.depth=this._getDepth(e),this.rowKey=this._getRowKey(e);var o=this._getState(e),r=this._getLeaf(e);this.iconState=o||(r?"leaf":this._getDataProviderExpanded().has(this.rowKey)?"expanded":"collapsed"),this.index=this._getIndex(e),this.parentKey=this._getParentKey(e),this._addIndentation(),this._addIcon(),this._setIconStateClass(),"expanded"===this.iconState||"collapsed"===this.iconState?(n(this.toucharea).on("touchend",function(e){e.preventDefault(),t._fireExpandCollapse()}),n(this.toucharea).on("click",function(e){e.preventDefault(),t._fireExpandCollapse()}),n(this.element).on("keypress",function(e){var s=e.keyCode||e.which;s!==n.ui.keyCode.ENTER&&s!==n.ui.keyCode.SPACE||(t._fireExpandCollapse(),e.preventDefault(),e.target.focus())}),this.handleKeyDownCallback=this._handleKeyDownEvent.bind(this),this.component.element.get(0).addEventListener("keydown",this.handleKeyDownCallback,!0),this.handleExpandCallback=this._handleExpandEvent.bind(this),this.handleCollapseCallback=this._handleCollapseEvent.bind(this),this._isDataProvider()||(this.datasource.on("expand",this.handleExpandCallback,this),this.datasource.on("collapse",this.handleCollapseCallback,this)),this._initExpanded()):"leaf"===this.iconState&&(this.handleKeyDownCallback=this._handleKeyDownEvent.bind(this),this.component.element.get(0).addEventListener("keydown",this.handleKeyDownCallback,!0),n(this.icon).attr("tabindex",-1)),this.handleActiveKeyChangeCallback=this._handleActiveKeyChangeEvent.bind(this),this.component._IsCustomElement()?n(this.component.element).on("ojBeforeCurrentCell",this.handleActiveKeyChangeCallback):n(this.component.element).on("ojbeforecurrentcell",this.handleActiveKeyChangeCallback)}else i.warn("Context is not setup for the rowExpander")},_initExpanded:function(){if(!this._isDataProvider()){var t=this.options.expanded;null!=t?t&&"collapsed"===this.iconState?this._expand():t||"expanded"!==this.iconState||this._collapse():this.options.expanded="collapsed"!==this.iconState}},_isDataProvider:function(){return e.DataProviderFeatureChecker.isDataProvider(this.datasource)},_getDepth:function(t){var e=t;return t.item&&(e=t.item.metadata),this._isDataProvider()?e.treeDepth+1:e.depth},_getRowKey:function(t){var e=t;return t.item&&(e=t.item.metadata),e.key},_getState:function(t){var e=t;return t.item&&(e=t.item.metadata),e.state},_getParentKey:function(t){var e=t;return t.item&&(e=t.item.metadata),e.parentKey},_getIndex:function(t){var e=t;return t.item&&(e=t.item.metadata),this._isDataProvider()?e.indexFromParent:e.index},_getLeaf:function(t){var e=t;return t.item&&(e=t.item.metadata),e.isLeaf},_getDataProviderExpanded:function(){return this._dataSourceExpanded},_getFlattenedDataProvider:function(){return this.datasource.getExpandedObservable?this.datasource:this.datasource.dataProvider},_getChildCount:function(t){return this._isDataProvider()?(null!=t?this._getFlattenedDataProvider().dataProvider.getChildDataProvider(this.parentKey):this._getFlattenedDataProvider().dataProvider).getTotalSize():this.datasource.getWrappedDataSource().getChildCount(this.parentKey)},refresh:function(){this.element.empty(),this._initContent()},_destroy:function(){this.component.element.get(0).removeEventListener("ojkeydown",this.handleKeyDownCallback,!0),n(this.component.element).off("ojbeforecurrentcell",this.handleActiveKeyChangeCallback),this._isDataProvider()?this._dataProviderSubscription.unsubscribe():(this.datasource.off("expand",this.handleExpandCallback,this),this.datasource.off("collapse",this.handleCollapseCallback,this)),this.element.removeClass(this.classNames.root),this.element.empty()},_subscribeToDataProvider:function(){var t=this,e=this._getFlattenedDataProvider().getExpandedObservable();t._dataProviderSubscription=e.subscribe(function(e){var n=!1,s=!1;if(t._dataSourceExpanded=e.value,"expanded"!==t.iconState||t._dataSourceExpanded.has(t.rowKey)||(n=!0,t._loading()),"collapsed"===t.iconState&&t._dataSourceExpanded.has(t.rowKey)&&(s=!0,t._loading()),s||n){var a=e.completionPromise;a&&a.then(function(){s&&t._handleExpandEvent({rowKey:t.rowKey}),n&&t._handleCollapseEvent({rowKey:t.rowKey})})}})},_expand:function(){return"collapsed"===this.iconState&&(this._loading(),this._isDataProvider()?this._getFlattenedDataProvider().setExpanded(this._getDataProviderExpanded().add([this.rowKey])):this.datasource.expand(this.rowKey),!0)},_collapse:function(){return"expanded"===this.iconState&&(this._loading(),this._isDataProvider()?this._getFlattenedDataProvider().setExpanded(this._getDataProviderExpanded().delete([this.rowKey])):this.datasource.collapse(this.rowKey),!0)},_setOption:function(t,e,n){"expanded"!==t||this._isDataProvider()||null!=n._context&&!0===n._context.internalSet?(this._super(t,e,n),"context"===t&&null!=n._context&&!0!==n._context.internalSet&&this.refresh()):e?this._expand():this._collapse()},_addIndentation:function(){var t=this.depth-1;if(t<this.constants.MAX_STYLE_DEPTH)this._appendSpacer(t);else{for(var e=1;e<=t/this.constants.MAX_STYLE_DEPTH;e++)this._appendSpacer(this.constants.MAX_STYLE_DEPTH);var n=t%this.constants.MAX_STYLE_DEPTH;n<this.constants.MAX_STYLE_DEPTH&&this._appendSpacer(n)}},_appendSpacer:function(t){var e=n(document.createElement("span")).addClass(this.classNames.indent).addClass(this.classNames["depth"+t]);this.element.append(e)},_addIcon:function(){var t=n(document.createElement("div")).addClass(this.classNames.iconspacer);this.toucharea=n(document.createElement("div")).addClass(this.classNames.toucharea),this.icon=n(document.createElement("a")).attr("href","leaf"===this.iconState?"":"#").attr("aria-labelledby",this._getLabelledBy()).addClass(this.classNames.icon).addClass(this.classNames.clickable).attr("aria-label",this.getTranslatedString("accessibleLevelDescription",{level:this.depth})),this.element.append(t.append(this.toucharea.append(this.icon)));this._focusable({element:this.icon,applyHighlight:!0})},_addIconClass:function(t){this.icon.addClass(this.classNames[t])},_removeIconClass:function(t){this.icon.removeClass(this.classNames[t])},_setIconStateClass:function(){switch(this.iconState){case"leaf":this._removeIconClass("icon"),this._removeIconClass("clickable"),this._addIconClass("leaf");break;case"collapsed":this._addIconClass("expand"),this._ariaExpanded(!1);break;case"expanded":this._addIconClass("collapse"),this._ariaExpanded(!0);break;case"loading":this._removeIconClass("clickable"),this._addIconClass("lazyload")}},_removeIconStateClass:function(){switch(this.iconState){case"leaf":this._removeIconClass("leaf"),this._addIconClass("icon"),this._addIconClass("clickable");break;case"collapsed":this._removeIconClass("expand");break;case"expanded":this._removeIconClass("collapse");break;case"loading":this._removeIconClass("lazyload"),this._addIconClass("clickable")}},_handleActiveKeyChangeEvent:function(t,e){var n;if(null==e&&(e=t.detail),null!=e.currentCell){var s="cell"===e.currentCell.type?e.currentCell.keys.row:e.currentCell.key;if(null!=e.previousValue&&(n="cell"===e.previousCurrentCell.type?e.previousCurrentCell.keys.row:e.previousCurrentCell.key),this.rowKey===s&&n!==s&&this.component._setAccessibleContext){var a,i=this.getTranslatedString("accessibleRowDescription",{level:this.depth,num:this.index+1,total:this._getChildCount(this.parentKey)});a="collapsed"===this.iconState?this.getTranslatedString("accessibleStateCollapsed"):"expanded"===this.iconState?this.getTranslatedString("accessibleStateExpanded"):"",this.component._setAccessibleContext({context:i,state:a})}}},_handleKeyDownEvent:function(t){var e=a.__GetWidgetConstructor(this.component.element.get(0))("getContextByNode",t.target);if(null!=e){var i=e.key;if(null==i&&(i=e.keys.row),this.rowKey===i){var o=t.keyCode||t.which;if(s.isMetaKeyPressed(t))if(o===n.ui.keyCode.RIGHT)this._expand()&&t.preventDefault();else if(o===n.ui.keyCode.LEFT)this._collapse()&&t.preventDefault();else if(t.altKey&&o===this.constants.NUM5_KEY&&this.component._setAccessibleContext){var r;if(!this._isDataProvider()){var h=this.datasource.getAncestors(this.rowKey);if(null!=h&&h.length>0){r=[];for(var d=0;d<h.length;d++)r.push({key:h[d],label:this.getTranslatedString("accessibleLevelDescription",{level:d+1})})}}var l=this.getTranslatedString("accessibleRowDescription",{level:this.depth,num:this.index+1,total:this._getChildCount(this.parentKey)});this.component._setAccessibleContext({context:l,state:"",ancestors:r})}}}},_loading:function(){this._removeIconStateClass(),this.iconState="loading",this._setIconStateClass()},_handleExpandEvent:function(t){var e=null!=t.rowKey?t.rowKey:t.detail.key;if(e===this.rowKey){this._removeIconStateClass(),this.iconState="expanded",this._setIconStateClass(),this._ariaExpanded(!0),this._updateContextState("expanded");var n=this.options.expanded;(null==n||null!=n&&!n)&&(this._trigger("expand",null,{rowKey:e}),this._updateExpandedState(!0))}},_handleCollapseEvent:function(t){var e=null!=t.rowKey?t.rowKey:t.detail.key;if(e===this.rowKey){this._removeIconStateClass(),this.iconState="collapsed",this._setIconStateClass(),this._ariaExpanded(!1),this._updateContextState("collapsed");var n=this.options.expanded;(null==n||null!=n&&n)&&(this._trigger("collapse",null,{rowKey:e}),this._updateExpandedState(!1))}},_updateExpandedState:function(t){this.option("expanded",t,{changed:!0,_context:{internalSet:!0,writeback:!0}})},_updateContextState:function(t){var e=this.options.context;this._setState(e,t),this.option("context",e,{changed:!0,_context:{internalSet:!0}})},_setState:function(t,e){var n=t;t.item&&(n=t.item.metadata),n.state=e},_fireExpandCollapse:function(){var t=this.iconState;this._isDataProvider()||this._loading(),"collapsed"===t?this._isDataProvider()?this._getFlattenedDataProvider().setExpanded(this._getDataProviderExpanded().add([this.rowKey])):this.datasource.expand(this.rowKey):"expanded"===t&&(this._isDataProvider()?this._getFlattenedDataProvider().setExpanded(this._getDataProviderExpanded().delete([this.rowKey])):this.datasource.collapse(this.rowKey))},_ariaExpanded:function(t){this.icon.attr("aria-expanded",t)},getNodeBySubId:function(t){if(null==t)return this.element?this.element[0]:null;var e=t.subId;return"oj-rowexpander-disclosure"!==e&&"oj-rowexpander-icon"!==e||null==this.icon?null:this.icon.get(0)},getSubIdByNode:function(t){return t===this.icon.get(0)?{subId:"oj-rowexpander-disclosure"}:null},_NotifyAttached:function(){this._super(),this.icon.attr("aria-labelledby",this._getLabelledBy())},_getLabelledBy:function(){return this.element.parent().closest("[id]").attr("id")}})});
//# sourceMappingURL=ojrowexpander.js.map