!function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,i){return(t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,i)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var i,l=n(e);if(t){var o=n(this).constructor;i=Reflect.construct(l,arguments,o)}else i=l.apply(this,arguments);return r(this,i)}}function r(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["exports","ojs/ojcore-base","ojs/ojdomutils","ojs/ojvcomponent-element","ojs/ojtranslation","ojs/ojfilepickerutils"],function(r,n,a,s,c,u){"use strict";n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var p=function(e,t,i,r){var n,l=arguments.length,a=l<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(l<3?n(a):l>3?n(t,i,a):n(t,i))||a);return l>3&&a&&Object.defineProperty(t,i,a),a};r.FilePicker=function(r){!function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&t(e,i)}(h,r);var o,p,d,f=i(h);function h(e){var t;return l(this,h),(t=f.call(this,e)).inDropZone=!1,t.isDroppable=!1,t.selecting=!1,t.state={focus:!1,validity:"NA"},t.rootElemRef=function(e){t.rootElem=e},t}return o=h,(p=[{key:"_doSelectHelper",value:function(e){var t=this,i=new Promise(function(e){t.elementPromiseResolver=e});return this._fileSelectedHelper(e),i}},{key:"_handleSelectingFiles",value:function(e){var t;if("click"===e.type||"keypress"===e.type&&13===e.keyCode){this.selecting=!0,e.preventDefault();var i=this.props;return u.pickFiles(this._handleFileSelected,{accept:i.accept,selectionMode:i.selectionMode,capture:null!==(t=i.capture)&&void 0!==t?t:"none"}),!0}return!1}},{key:"_handleFileSelected",value:function(e){this._fileSelectedHelper(e)}},{key:"_fileSelectedHelper",value:function(e){if(e.length>0){var t=this._validateTypes(e).rejected;t.length>0?this._fireInvalidSelectAction(this._getMimeTypeValidationMessages(t),event,!1):this._handleFilesAdded(e,event)}this.selecting=!1}},{key:"_handleDragEnter",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"_handleDragOver",value:function(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer;if(!this.inDropZone){var i=n.AgentUtils.getAgentInfo();if(this.inDropZone=!0,this.isDroppable=!0,i.browser!==n.AgentUtils.BROWSER.SAFARI&&i.browser!==n.AgentUtils.BROWSER.IE){var r=t.items,l=[],o=this._validateSelectionMode(r),a=this._validateTypes(r);o&&0===a.rejected.length?this.updateState({validity:"valid"}):(this.isDroppable=!1,o?l=this._getMimeTypeValidationMessages(a.rejected):l.push({severity:"error",summary:c.getTranslatedString("oj-ojFilePicker.singleFileUploadError")}),this._fireInvalidSelectAction(l,e,!0))}else this.updateState({validity:"valid"})}}},{key:"_handleDragLeave",value:function(e,t){this.inDropZone&&(e.preventDefault(),e.stopPropagation(),this.rootElem.contains(e.relatedTarget)||(this.inDropZone=!1,this.updateState({validity:"NA"}),this.isDroppable||t||(this.dragPromiseResolver(),this.dragPromiseResolver=null)))}},{key:"_handleFileDrop",value:function(e){if(this.inDropZone){e.preventDefault(),e.stopPropagation();var t=this._createFileList(e.dataTransfer.files),i=!1;if(this.isDroppable){var r=[];if(this._validateSelectionMode(t)){var n=this._validateTypes(t);n.rejected.length>0&&(r=this._getMimeTypeValidationMessages(n.rejected),i=!0)}else r.push({severity:"error",summary:c.getTranslatedString("oj-ojFilePicker.singleFileUploadError")});r.length>0&&(this.isDroppable=!1,this._fireInvalidSelectAction(r,e,!1)),this.isDroppable&&this._handleFilesAdded(t,e)}this._handleDragLeave(e,i)}}},{key:"_handleFocusIn",value:function(){this.selecting||this.updateState({focus:!a.recentPointer()})}},{key:"_handleFocusOut",value:function(){this.selecting||this.updateState({focus:!1})}},{key:"render",value:function(){var e=this.props,t=this.props.trigger;if(e.disabled)return this._renderDisabled(e,t);var i="drop"!=e.selectOn?this._handleSelectingFiles:void 0;return t?this._renderWithCustomTrigger(e,t,i):this._renderWithDefaultTrigger(e,i)}},{key:"_renderDisabled",value:function(e,t){var i=t?"oj-filepicker":"oj-filepicker oj-filepicker-no-trigger";return s.h("oj-file-picker",{class:i},s.h("div",{class:"oj-filepicker-disabled oj-filepicker-container"},t||this._renderDefaultTriggerContent(e)))}},{key:"_renderWithCustomTrigger",value:function(e,t,i){var r=this._getDndHandlers(e);return s.h("oj-file-picker",{class:"oj-filepicker"+this._getFocusClass(),ref:this.rootElemRef,onFocusin:this._handleFocusIn,onFocusout:this._handleFocusOut},s.h("div",{onClick:i,onKeypress:this._handleSelectingFiles,onDragenter:r.handleDragEnter,onDragover:r.handleDragOver,onDragleave:r.handleDragLeave,onDragend:r.handleDragLeave,onDrop:r.handleFileDrop,class:"oj-filepicker-container"},t))}},{key:"_renderWithDefaultTrigger",value:function(e,t){var i=this.state.validity,r="valid"===i?" oj-valid-drop":"invalid"===i?" oj-invalid-drop":"",n=this._getDndHandlers(e);return s.h("oj-file-picker",{class:"oj-filepicker oj-filepicker-no-trigger",ref:this.rootElemRef},s.h("div",{onClick:t,onKeypress:this._handleSelectingFiles,class:"oj-filepicker-container"},s.h("div",{tabindex:"0",class:"oj-filepicker-dropzone"+r+this._getFocusClass(),onDragenter:n.handleDragEnter,onDragover:n.handleDragOver,onDragleave:n.handleDragLeave,onDragend:n.handleDragLeave,onDrop:n.handleFileDrop,onFocusin:this._handleFocusIn,onFocusout:this._handleFocusOut},this._renderDefaultTriggerContent(e))))}},{key:"_renderDefaultTriggerContent",value:function(e){var t,i="single"==e.selectionMode,r=e.primaryText;t=r?"string"==typeof r?r:r():c.getTranslatedString("oj-ojFilePicker.dropzonePrimaryText");var n,l=e.secondaryText;return n=l?"string"==typeof l?l:l({selectionMode:e.selectionMode}):c.getTranslatedString(i?"oj-ojFilePicker.secondaryDropzoneText":"oj-ojFilePicker.secondaryDropzoneTextMultiple"),[s.h("div",null,s.h("div",{class:"oj-filepicker-text"},t),s.h("div",{class:"oj-filepicker-secondary-text"},n)),s.h("div",{class:"oj-filepicker-icon oj-fwk-icon-plus oj-fwk-icon"})]}},{key:"_getDndHandlers",value:function(e){return"click"!=e.selectOn?{handleDragEnter:this._handleDragEnter,handleDragOver:this._handleDragOver,handleDragLeave:this._handleDragLeave,handleFileDrop:this._handleFileDrop}:{}}},{key:"_getFocusClass",value:function(){return this.state.focus?" oj-focus-highlight":""}},{key:"_validateSelectionMode",value:function(e){return"single"!==this.props.selectionMode||1===e.length}},{key:"_validateTypes",value:function(e){var t,i,r=[],n=[];if(e)for(var l=0;l<e.length;l++){var o=(t=e[l]).name;if(i=c.getTranslatedString("oj-ojFilePicker.unknownFileType"),o){var a=o.split(".");i=a.length>1?"."+a.pop():i}i=t.type?t.type:i,-1===r.indexOf(i)&&-1===n.indexOf(i)&&(this._acceptFile(t)?r.push(i):n.push(i))}return{accepted:r,rejected:n}}},{key:"_getMimeTypeValidationMessages",value:function(e){var t=[];return 1===e.length?t.push({severity:"error",summary:c.getTranslatedString("oj-ojFilePicker.singleFileTypeUploadError",{fileType:e[0]})}):t.push({severity:"error",summary:c.getTranslatedString("oj-ojFilePicker.multipleFileTypeUploadError",{fileTypes:e.join(c.getTranslatedString("oj-converter.plural-separator"))})}),t}},{key:"_acceptFile",value:function(e){var t,i=this.props.accept;if(!i||0===i.length||!e)return!0;for(var r=0;r<i.length;r++){if(!(t=n.StringUtils.trim(i[r])))return!0;if(t.startsWith(".",0)){if(!e.name||e.name&&e.name.endsWith(t))return!0}else{if(!e.type)return!1;if("image/*"===t){if(e.type.startsWith("image/",0))return!0}else if("video/*"===t){if(e.type.startsWith("video/",0))return!0}else if("audio/*"===t){if(e.type.startsWith("audio/",0))return!0}else if(e.type===t)return!0}}return!1}},{key:"_handleFilesAdded",value:function(e,t){var i,r,n=this,l=this._createFileList(e);null===(r=(i=this.props).onOjBeforeSelect)||void 0===r||r.call(i,{files:l,originalEvent:t}).then(function(){var e,i;null===(i=(e=n.props).onOjSelect)||void 0===i||i.call(e,{files:l,originalEvent:t}),n.elementPromiseResolver&&(n.elementPromiseResolver(),n.elementPromiseResolver=null)},function(e){n._fireInvalidSelectAction(e,t,!1)})}},{key:"_fireInvalidSelectAction",value:function(e,t,i){var r,n,l=this;i&&this.updateState({validity:"invalid"});var o=i?new Promise(function(e){l.dragPromiseResolver=e}):null;null===(n=(r=this.props).onOjInvalidSelect)||void 0===n||n.call(r,{messages:e,originalEvent:t,until:o}),this.elementPromiseResolver&&(this.elementPromiseResolver(),this.elementPromiseResolver=null)}},{key:"_createFileList",value:function(e){for(var t={length:{value:e.length},item:{value:function(e){return this[e]}}},i=0;i<e.length;i++)t[i]={value:e[i],enumerable:!0};return Object.create(FileList.prototype,t)}}])&&e(o.prototype,p),d&&e(o,d),h}(s.ElementVComponent),r.FilePicker.metadata={extension:{_DEFAULTS:function e(){l(this,e),this.accept=null,this.capture="none",this.disabled=!1,this.selectOn="auto",this.selectionMode="multiple"}},properties:{accept:{type:"Array<string>|null",value:null},capture:{type:"string|null",enumValues:["user","environment","implementation","none"],value:"none"},disabled:{type:"boolean",value:!1},primaryText:{type:"string|function"},secondaryText:{type:"string|function"},selectOn:{type:"string",enumValues:["auto","click","clickAndDrop","drop"],value:"auto"},selectionMode:{type:"string",enumValues:["multiple","single"],value:"multiple"}},slots:{trigger:{}},events:{ojBeforeSelect:{cancelable:!0},ojInvalidSelect:{},ojSelect:{}},methods:{_doSelectHelper:{}}},p([s.listener()],r.FilePicker.prototype,"_handleSelectingFiles",null),p([s.listener()],r.FilePicker.prototype,"_handleFileSelected",null),p([s.listener()],r.FilePicker.prototype,"_handleDragEnter",null),p([s.listener()],r.FilePicker.prototype,"_handleDragOver",null),p([s.listener()],r.FilePicker.prototype,"_handleDragLeave",null),p([s.listener()],r.FilePicker.prototype,"_handleFileDrop",null),p([s.listener()],r.FilePicker.prototype,"_handleFocusIn",null),p([s.listener()],r.FilePicker.prototype,"_handleFocusOut",null),r.FilePicker=p([s.customElement("oj-file-picker")],r.FilePicker),Object.defineProperty(r,"__esModule",{value:!0})})}();
//# sourceMappingURL=ojfilepicker.js.map