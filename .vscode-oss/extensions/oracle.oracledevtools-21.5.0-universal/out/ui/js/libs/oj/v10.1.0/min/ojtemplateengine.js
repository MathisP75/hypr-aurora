/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["knockout","ojs/ojcore","ojs/ojkoshared","ojs/ojhtmlutils","ojs/ojvdom","ojs/ojlogger","ojs/ojcustomelement-utils"],function(e,t,n,o,r,a,i){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;return new function(){this.execute=function(t,n,o,r){var a=n.getAttribute("data-oj-as"),i=c(t,n,o,r,a);if(n.render)return this._executeVDomTemplate(n,i);var u=d(n);return e.applyBindingsToDescendants(i,u),Array.prototype.slice.call(u.childNodes,0)},this._executeVDomTemplate=function(t,n){var o=e.pureComputed({read:()=>t.render(n.$current)}).extend({rateLimit:0}),a=o();this._extendTemplateForVComponent(t),t._cachedRows.push({currentContext:n.$current,vnode:a,computedVNode:o});var i=r.mount(a,!1);return i.classList.add("oj-vdom-template-root"),i._vnodeTemplate=t,o.subscribe(e=>{var n=t._cachedRows.find(e=>e.computedVNode===o);r.patch(e,n.vnode,r.getMountedNode(n.vnode).parentNode,!1),n.vnode=e}),[i]},this._extendTemplateForVComponent=function(e){if(!e._cachedRows){var t=e.render;Object.defineProperties(e,{_cachedRows:{writable:!0,value:[]},render:{enumerable:!0,get:()=>t,set(e){t=e,e&&this._cachedRows.forEach(t=>{var n=e(t.currentContext);r.patch(n,t.vnode,r.getMountedNode(t.vnode).parentNode,!1),t.vnode=n})}}})}},this.clean=function(t){var n=t&&t.getElementsByClassName?t.getElementsByClassName("oj-vdom-template-root"):[];return Array.from(n).forEach(e=>{var t=e._vnodeTemplate,n=t._cachedRows.filter(t=>r.getMountedNode(t.vnode)!==e||(r.unmount(t.vnode),t.computedVNode.dispose(),!1));t._cachedRows=n}),0===n.length?e.cleanNode(t):null},this.resolveProperties=function(o,r,a,s,l,p,v,f){var m=r.getAttribute("data-oj-as"),h=c(o,r,l,p,m);return function(n,o,r){return a=e.pureComputed(function(){var a={};n.evalMap.forEach(function(t,n){var i=e.utils.unwrapObservable(t(o));r&&r(n,i),a[n[0]]=function(e,t,n){if(t.length<2)return n;for(var o=e[t[0]]||{},r=o,a=t.length-1,i=1;i<a;i++){var u=t[i],d=r[u]||{};r[u]=d,r=d}return r[t[a]]=n,o}(a,n,i)});var i=t.CollectionUtils.copyInto,u=i({},n.staticMap,null,!0);return u=i(u,a,null,!0)}),i=["peek","subscribe","dispose"],u={},i.forEach(function(e){u[e]=a[e].bind(a)}),u;var a,i,u}(function(e,t,o,r,a){var c=u.get(e);if(!c){c={},u.set(e,c);var s=d(e).querySelector(o);c.evalMap=function(e,t,o){for(var r=new Map,a=e?e.attributes:[],u=0;u<a.length;u++){var d=a[u],c=i.AttributeUtils.attributeToPropertyName(d.name).split(".");if(t.has(c[0])){var s=i.AttributeUtils.getExpressionInfo(d.value).expr;s&&r.set(c,n.createBindingExpressionEvaluator(s,o))}}return r}(s,r,t),c.staticMap=function(e,t,n){var o={};if(e){var r=e.style;r.display="none",r.position="absolute",e.setAttribute("data-oj-binding-provider","none"),n.appendChild(e),t.forEach(function(t){void 0!==e[t]&&(o[t]=e[t])}),n.removeChild(e)}return o}(s,r,a)}return c}(r,h,a,s,f||o),h,v)},this.defineTrackableProperty=function(t,n,o,r){!function(t,n,o,r){var a=e.observable(o);Object.defineProperty(t,n,{get:function(){return a()},set:function(e){a(e),r&&r(e)},enumerable:!0})}(t,n,o,r)};var u=new WeakMap;function d(e){for(var t=document.createElement("div"),n=o.getTemplateContent(e),r=0;r<n.length;r++)t.appendChild(n[r]);return t}function c(t,o,r,i,u){var d=o.__ojBindingContext?o.__ojBindingContext:e.contextFor(o);return d||(a.info("Binding context not found when processing template for element with id: "+t.id+". Using binding context for element instead."),d=e.contextFor(t)),n.extendBindingContext(d,r,i,u,t)}}});
//# sourceMappingURL=ojtemplateengine.js.map