!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["ojs/ojcore-base","ojs/ojdataprovider","ojs/ojeventtarget","ojs/ojcachediteratorresultsdataprovider","ojs/ojcomponentcore"],function(e,i,r,n,s){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * @ignore
   */
/**
   * @preserve Copyright 2013 jQuery Foundation and other contributors
   * Released under the MIT license.
   * http://jquery.org/license
   */
var o=function(){function r(s){var o=this;t(this,r),this.dataProvider=s,this.DedupAsyncIterable=function(){return function e(a,i,r,n){var s=this;t(this,e),this._parent=a,this.params=i,this.dataProviderAsyncIterator=r,this.cache=n,this[Symbol.asyncIterator]=function(){return new s._parent.DedupAsyncIterator(s._parent,s.params,s.dataProviderAsyncIterator,s.cache)}}}(),this.DedupAsyncIterator=function(){function e(a,i,r,n){t(this,e),this._parent=a,this.params=i,this.asyncIterator=r,this.cache=n,this._cachedOffset=0}return a(e,[{key:"next",value:function(){var t=this,e=this,a=new Set;this.params.size>0&&this._parent.cache.getDataByOffset({offset:0,size:this._cachedOffset}).results.forEach(function(t){a.add(t.metadata.key)});return this.asyncIterator.next().then(function(s){var o=s[r._VALUE],c=o.metadata.map(function(t){return t[r._KEY]});t._cachedOffset=t._cachedOffset+c.length;var h=new Set;c.forEach(function(t){h.add(t)});var d=[],u=[],f=[];if(h.forEach(function(t,e){a.has(t)&&(d.push(t),u.push(o.data[e]),f.push(o.metadata[e]))}),d.length>0){var p=new Set;d.map(function(t){p.add(t)});var v=new e._parent.DataProviderOperationEventDetail(e._parent,p,f,u,[]),l=new e._parent.DataProviderMutationEventDetail(e._parent,null,v,null);e._parent.dispatchEvent(new i.DataProviderMutationEvent(l))}return e._parent.dataProvider instanceof n||e._parent.cache.addListResult(s),s})}}]),e}(),this.DataProviderMutationEventDetail=function(){return function e(a,i,n,s){t(this,e),this._parent=a,this.add=i,this.remove=n,this.update=s,this[r._ADD]=i,this[r._REMOVE]=n,this[r._UPDATE]=s}}(),this.DataProviderOperationEventDetail=function(){return function e(a,i,n,s,o){t(this,e),this._parent=a,this.keys=i,this.metadata=n,this.data=s,this.indexes=o,this[r._KEYS]=i,this[r._METADATA]=n,this[r._DATA]=s,this[r._INDEXES]=o}}();var c=this;this.cache=s instanceof n?s.cache:new e.DataCache,s.createOptimizedKeyMap&&(this.createOptimizedKeyMap=function(t){return s.createOptimizedKeyMap(t)}),s.createOptimizedKeySet&&(this.createOptimizedKeySet=function(t){return s.createOptimizedKeySet(t)}),s.addEventListener(r._MUTATE,function(t){t.detail&&t.detail.add&&o._processAddMutations(t.detail.add),c.dispatchEvent(t)}),s.addEventListener(r._REFRESH,function(t){c.cache.reset(),c.dispatchEvent(t)})}return a(r,[{key:"containsKeys",value:function(t){return this.dataProvider.containsKeys(t)}},{key:"fetchByKeys",value:function(t){return this.dataProvider.fetchByKeys(t)}},{key:"fetchByOffset",value:function(t){return this.dataProvider.fetchByOffset(t)}},{key:"fetchFirst",value:function(t){var e=this.dataProvider.fetchFirst(t);return new this.DedupAsyncIterable(this,t,e[Symbol.asyncIterator](),this.cache)}},{key:"getCapability",value:function(t){var e=this.dataProvider.getCapability(t);return"dedup"===t?{type:"iterator"}:e}},{key:"getTotalSize",value:function(){return this.dataProvider.getTotalSize()}},{key:"isEmpty",value:function(){return this.dataProvider.isEmpty()}},{key:"_processAddMutations",value:function(t){var e=t[r._KEYS];if(e&&e.size>0){var a=new Set,n=[],s=[];if(this.cache.getDataByKeys({keys:e}).results.forEach(function(t,e){a.add(e),n.push(t.data),s.push(t.metadata)}),a.size>0){var o=new this.DataProviderOperationEventDetail(this,a,s,n,[]),c=new this.DataProviderMutationEventDetail(this,null,o,null);this.dispatchEvent(new i.DataProviderMutationEvent(c))}}}}]),r}();return o._KEY="key",o._KEYS="keys",o._DATA="data",o._METADATA="metadata",o._ITEMS="items",o._FROM="from",o._OFFSET="offset",o._REFRESH="refresh",o._MUTATE="mutate",o._SIZE="size",o._FETCHPARAMETERS="fetchParameters",o._VALUE="value",o._DONE="done",o._RESULTS="results",o._ADD="add",o._UPDATE="update",o._REMOVE="remove",o._INDEXES="indexes",r.EventTargetMixin.applyMixin(o),e._registerLegacyNamespaceProp("DedupDataProvider",o),o})}();
//# sourceMappingURL=ojdedupdataprovider.js.map