!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["ojs/ojcore-base","ojs/ojcachediteratorresultsdataprovider","ojs/ojdedupdataprovider","ojs/ojcomponentcore","ojs/ojeventtarget","ojs/ojdataprovider"],function(e,i,r,n,s,o){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;
/**
   * @license
   * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
   * The Universal Permissive License (UPL), Version 1.0
   * @ignore
   */
/**
   * @preserve Copyright 2013 jQuery Foundation and other contributors
   * Released under the MIT license.
   * http://jquery.org/license
   */
var c=function(){function n(s){t(this,n),this.dataProvider=s,this.MutateEventFilteringAsyncIterable=function(){return function e(a,i,r,n){var s=this;t(this,e),this._parent=a,this.params=i,this.dataProviderAsyncIterator=r,this.cache=n,this[Symbol.asyncIterator]=function(){return new s._parent.MutateEventFilteringAsyncIterator(s._parent,s.params,s.dataProviderAsyncIterator,s.cache)}}}(),this.MutateEventFilteringAsyncIterator=function(){function e(a,i,r,n){t(this,e),this._parent=a,this.params=i,this.asyncIterator=r,this.cache=n}return a(e,[{key:"next",value:function(){var t=this;return this.asyncIterator.next().then(function(e){return t._parent.dataProvider instanceof i||t._parent.dataProvider instanceof r||t._parent.cache.addListResult(e),e})}}]),e}(),this.DataProviderMutationEventDetail=function(){return function e(a,i,r){t(this,e),this.add=a,this.remove=i,this.update=r,this[n._ADD]=a,this[n._REMOVE]=i,this[n._UPDATE]=r}}();var o=this;this.cache=s instanceof i||s instanceof r?s.cache:new e.DataCache,s.createOptimizedKeyMap&&(this.createOptimizedKeyMap=function(t){return s.createOptimizedKeyMap(t)}),s.createOptimizedKeySet&&(this.createOptimizedKeySet=function(t){return s.createOptimizedKeySet(t)}),s.addEventListener(n._MUTATE,function(t){if(t.detail){var e=o._processMutations(t.detail.remove),a=o._processMutations(t.detail.update);if(e&&e.keys&&e.keys.size>0||a&&a.keys&&a.keys.size>0||t.detail.add&&t.detail.add.keys&&t.detail.add.keys.size>0){var i=new o.DataProviderMutationEventDetail(t.detail.add,e,a),r=Object.assign({},t);r.detail=i,o.dispatchEvent(r)}}else o.dispatchEvent(t)}),s.addEventListener(n._REFRESH,function(t){o.cache.reset(),o.dispatchEvent(t)})}return a(n,[{key:"containsKeys",value:function(t){return this.dataProvider.containsKeys(t)}},{key:"fetchByKeys",value:function(t){return this.dataProvider.fetchByKeys(t)}},{key:"fetchByOffset",value:function(t){return this.dataProvider.fetchByOffset(t)}},{key:"fetchFirst",value:function(t){var e=this.dataProvider.fetchFirst(t);return new this.MutateEventFilteringAsyncIterable(this,t,e[Symbol.asyncIterator](),this.cache)}},{key:"getCapability",value:function(t){var e=this.dataProvider.getCapability(t);return"eventFiltering"===t?{type:"iterator"}:e}},{key:"getTotalSize",value:function(){return this.dataProvider.getTotalSize()}},{key:"isEmpty",value:function(){return this.dataProvider.isEmpty()}},{key:"_processMutations",value:function(t){if(t){var e=t[n._KEYS];if(e&&e.size>0){var a=new Set,i=this.cache.getDataByKeys({keys:e});e.forEach(function(t){i.results.has(t)||a.add(t)});var r=Object.assign({},t);return a.forEach(function(t){var e=[];r.keys.forEach(function(t){e.push(t)});var a=e.indexOf(t);r.keys.delete(t),e.splice(a,1),r.data&&r.data.splice(a,1),r.indexes&&r.indexes.splice(a,1),r.metadata&&r.metadata.splice(a,1)}),r}}return t}}]),n}();return c._KEY="key",c._KEYS="keys",c._DATA="data",c._METADATA="metadata",c._ITEMS="items",c._FROM="from",c._OFFSET="offset",c._REFRESH="refresh",c._MUTATE="mutate",c._SIZE="size",c._FETCHPARAMETERS="fetchParameters",c._VALUE="value",c._DONE="done",c._RESULTS="results",c._ADD="add",c._UPDATE="update",c._REMOVE="remove",c._INDEXES="indexes",s.EventTargetMixin.applyMixin(c),e._registerLegacyNamespaceProp("MutateEventFilteringDataProvider",c),c})}();
//# sourceMappingURL=ojmutateeventfilteringdataprovider.js.map