!function(){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function i(t,e,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=a(t);if(e){var o=a(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return r(this,n)}}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e):n}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}
/**
 * @license
 * Copyright (c) 2014, 2021, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */define(["exports","ojs/ojcore-base","ojs/ojdatacollection-common","ojs/ojanimation","ojs/ojthemeutils","ojs/ojvcomponent-element","ojs/ojcontext","ojs/ojlogger","ojs/ojvcollection","ojs/ojdomutils"],function(n,s,r,h,d,f,y,p,v,m){"use strict";s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,y=y&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y;var g,k=function(){function t(e,n,i,o,s){u(this,t),this.dataProvider=e,this.fullWidth=n,this.gutterWidth=i,this.itemWidth=o,this.cache=s,this.columns=0,this.margin=0,this.columnsInfo=[],this.bottom=0,this.keys=[],e&&(this.modelEventHandler=this._handleModelEvent.bind(this),e.addEventListener("mutate",this.modelEventHandler)),null==this.cache&&(this.cache=new Map)}return c(t,[{key:"destroy",value:function(){this.dataProvider&&this.modelEventHandler&&this.dataProvider.removeEventListener("mutate",this.modelEventHandler)}},{key:"_initializeColumnsInfo",value:function(){this.columns=Math.max(1,Math.floor(this.fullWidth/(this.itemWidth+this.gutterWidth))),this.margin=Math.max(this.gutterWidth,(this.fullWidth-this.columns*(this.itemWidth+this.gutterWidth))/2),this.columnsInfo.length=this.columns;for(var t=0;t<this.columns;t++)this.columnsInfo[t]=0}},{key:"_populatePositions",value:function(t,e,n,i,o,s){for(var l=0;l<t.length;l++){var r=n(t[l]);if(null!=r){var a=l+e,u=a%this.columnsInfo.length,h=void 0,c=this.cache.get(r);if(c&&!isNaN(c.height)){if(h=c.height,!1!==c.valid&&!isNaN(c.top)&&!isNaN(c.left)){i(a,r,u,c);continue}}else h=o(t[l]);if(isNaN(h))return;var d=this.margin,f=void 0;if(a<this.columnsInfo.length)d+=u*(this.itemWidth+this.gutterWidth),f={top:this.gutterWidth,left:d,height:h,valid:!0},this.columnsInfo[u]=h+2*this.gutterWidth,this.bottom=Math.max(this.bottom,h);else{var y=this.columnsInfo.reduce(function(t,e){return Math.min(t,e)}),p=this.columnsInfo.indexOf(y);f={top:y,left:d+=p*(this.itemWidth+this.gutterWidth),height:h,valid:!0},this.columnsInfo[p]=this.columnsInfo[p]+h+this.gutterWidth,this.bottom=Math.max(this.bottom,y+h)}f&&(-1===this.keys.indexOf(r)&&this.keys.push(r),this.cache.set(r,f),s&&s(r,f))}}}},{key:"setWidth",value:function(t){this.fullWidth!==t&&(this.fullWidth=t,this.columnsInfo.length>0&&(this._initializeColumnsInfo(),this._invalidatePositions(0)))}},{key:"getPositionForItems",value:function(t,e){var n=new Map;null==this.itemWidth&&t.length>0&&(this.itemWidth=t[0].element.offsetWidth),0===this.columnsInfo.length&&this._initializeColumnsInfo(),this._populatePositions(t,e,function(t){return t.key},function(t,e,i,o){n.set(e,o)},function(t){return t.element.offsetHeight},function(t,e){n.set(t,e)});for(var i=0,o=new Set,s=Array.from(n.values()),l=0;l<s.length;l++){var r=s[l].left;if(o.has(r)||o.add(r),i=Math.max(i,s[l].top),o.size===this.columnsInfo.length)break}o.clear();for(var a=Number.MAX_VALUE,u=s.length-1;u>=0;u--){var h=s[u].left;if(o.has(h)||o.add(h),a=Math.min(a,s[u].top+s[u].height),o.size===this.columnsInfo.length)break}return{start:i,end:a,positions:n}}},{key:"getItemWidth",value:function(){return this.itemWidth}},{key:"getPositions",value:function(){return this.cache}},{key:"getPosition",value:function(t){return this.cache.get(t)}},{key:"getLastItemPosition",value:function(){return this.bottom}},{key:"getColumnsInfo",value:function(){var t=this;return this.columnsInfo.map(function(e,n){return{top:e,left:t.margin+n*(t.itemWidth+t.gutterWidth)}})}},{key:"_handleModelEvent",value:function(t){if("mutate"===t.type){var e=t.detail;if(e.add){var n=e.add.addBeforeKeys;if(null!=n){var i=Array.from(e.add.keys);this._insertKeys(n,i)}}if(e.remove){var o=Array.from(e.remove.keys);this._removeKeys(o)}if(e.update){var s=Array.from(e.update.keys);this._updateKeys(s)}}}},{key:"_insertKeys",value:function(t,e){var n=this,i=Number.MAX_VALUE;t.forEach(function(t,o){var s=n.keys.indexOf(t),l=e[o];s>-1&&(i=Math.min(i,s),n.keys.splice(s,0,l),n.cache.set(l,{top:void 0,left:void 0,height:void 0,valid:!1}))}),this._invalidatePositions(i)}},{key:"_removeKeys",value:function(t){var e=this,n=Number.MAX_VALUE;t.forEach(function(t){e.cache.delete(t);var i=e.keys.indexOf(t);i>-1&&(n=Math.min(n,i),e.keys.splice(i,1))}),this._invalidatePositions(n)}},{key:"_updateKeys",value:function(t){var e=this,n=Number.MAX_VALUE;t.forEach(function(t){var i=e.keys.indexOf(t);if(i>-1){n=Math.min(n,i+1);var o=e.getPosition(t);o&&(o.top=void 0,o.left=void 0,o.height=void 0,o.valid=!1)}}),this._invalidatePositions(n)}},{key:"_invalidatePositions",value:function(t){for(var e=t;e<this.keys.length;e++){var n=this.cache.get(this.keys[e]);null!=n&&(n.valid=!1)}for(var i=0;i<this.columns;i++)this.columnsInfo[i]=0;this.recalculatePositions()}},{key:"recalculatePositions",value:function(){var t=this;this._populatePositions(this.keys,0,function(t){return t},function(e,n,i,o){var s=o.height;if(e<t.columnsInfo.length)t.columnsInfo[i]=s+2*t.gutterWidth,t.bottom=Math.max(t.bottom,s);else{var l=t.columnsInfo.reduce(function(t,e){return Math.min(t,e)}),r=t.columnsInfo.indexOf(l);t.columnsInfo[r]=t.columnsInfo[r]+s+t.gutterWidth,t.bottom=Math.max(t.bottom,l+s)}},function(t){})}}]),t}(),b=function(t){o(s,t);var n=l(s);function s(t,e,i,o,l){var r;return u(this,s),(r=n.call(this,t,e,i,o)).root=t,r.dataProvider=e,r.callback=i,r.scrollPolicyOptions=o,r.gutterWidth=l,r.postRender=function(){var t=r.root.lastElementChild.firstElementChild;t&&null==r.adjustPositionsResolveFunc&&(r.adjustPositionsResolveFunc=r.addBusyState("adjusting item positions"),y.getContext(t).getBusyContext().whenReady().then(function(){if(r.adjustPositionsResolveFunc&&(r.adjustPositionsResolveFunc(),r.adjustPositionsResolveFunc=null),r.callback){var t=r._adjustAllItems();if(t.done){if(r.newItemsTracker.clear(),r.domScroller&&!r.domScroller.checkViewport())return;r.callback.renderComplete(t.items),r.initialFetch=!1}}}))},r.newItemsTracker=new Set,r.vnodesCache=new Map,r}return c(s,[{key:"destroy",value:function(){i(a(s.prototype),"destroy",this).call(this),this.layout&&this.layout.destroy()}},{key:"getLayout",value:function(){return null==this.layout&&(this.layout=new k(this.dataProvider,this.root.clientWidth,this.gutterWidth,null,null)),this.layout}},{key:"_adjustAllItems",value:function(){var t=this,e=!0,n=Array.from(this.root.querySelectorAll(".oj-waterfalllayout-item")).map(function(n){return"false"===n.getAttribute("data-oj-positioned")&&(e=!1),{key:t.getKey(n),element:n}});if(e)return{done:!0,items:n};var i=this.callback.getData().startIndex,o=this.getLayout().getPositionForItems(n,isNaN(i)?0:i);return this.callback.setPositions(o.positions),this.callback.setContentHeight(this.getLayout().getLastItemPosition()),this.domScroller&&this.domScroller.setViewportRange(o.start,o.end),{done:!1,items:n}}},{key:"handleResizeWidth",value:function(t){this.initialFetch=!1,this.getLayout().setWidth(t)}},{key:"fetchSuccess",value:function(t){null!=t&&this.newItemsTracker.clear(),this.initialFetch=!1,i(a(s.prototype),"fetchSuccess",this).call(this,t)}},{key:"beforeFetchByOffset",value:function(t,e){return this.isRenderingViewportOnly()&&this.vnodesCache.clear(),i(a(s.prototype),"beforeFetchByOffset",this).call(this,t,e)}},{key:"addItem",value:function(t,e,n,i){var o=-1,s=-1,l=this.getLayout().getPosition(t);null!=l?isNaN(l.left)||isNaN(l.top)||(o=l.left,s=l.top):this.newItemsTracker.add(t);var r=this.isInitialFetch();null==this.callback.getCurrentItem()&&r&&0==e&&this.callback.setCurrentItem(t);var a=this.renderItem(t,e,n);return this.decorateItem(a,t,o,s,r,i),a}},{key:"renderItem",value:function(t,e,n){var i=this.vnodesCache.get(t);if(i){if(i.index===e)return i.vnodes;this.vnodesCache.clear()}var o=this.callback.getItemRenderer()({data:n,index:e,key:t});return this.vnodesCache.set(t,{index:e,vnodes:o}),o}},{key:"decorateItem",value:function(t,e,n,i,o,s){for(var l,r=0;r<t.length;r++){var a=t[r]._node;if(1===a.nodeType){l=a;break}}if(null!=l){l.key=e,l.setAttribute("role","gridcell"),l.setAttribute("tabIndex","-1"),l.setAttribute("data-oj-positioned",-1!=n&&-1!=i?"true":"false"),this.getItemStyleClass(s,n,i,this.newItemsTracker.has(e),o).forEach(function(t){l.classList.add(t)});var u=this.getItemInlineStyle(s,n,i,o);Object.keys(u).forEach(function(t){l.style[t]=u[t]})}}},{key:"getItemInlineStyle",value:function(t,e,n,i){var o={};return-1===e||-1===n?(o.top=0,o.left=0):(o.left=e+"px",o.top=n+"px"),t&&-1!=e&&-1!=n&&!i&&(o.visibility="visible"),o}},{key:"getItemStyleClass",value:function(t,e,n,i,o){var s=[];return t&&(s.push("oj-waterfalllayout-item"),-1!=e&&-1!=n&&!o&&i&&s.push("oj-waterfalllayout-new-item")),s}},{key:"renderSkeletonsForLoadMore",value:function(){var t=this.getLayout(),n=t.getColumnsInfo(),i=t.getItemWidth(),o=[],s=Math.max.apply(Math,e(n.map(function(t){return t.top})));if(s>0){var l=s+100;this.callback.setContentHeight(l);var r=n.map(function(t){return{left:t.left,top:t.top,height:l-t.top,width:i}});o=this.callback.renderSkeletons(r)}return o}},{key:"handleCurrentRangeItemUpdated",value:function(t){var e=this.getLayout().getPosition(t);e&&(e.top=void 0,e.left=void 0),i(a(s.prototype),"handleCurrentRangeItemUpdated",this).call(this,t)}},{key:"handleItemsUpdated",value:function(t){var e=this;t.keys.forEach(function(t){e.vnodesCache.delete(t)}),i(a(s.prototype),"handleItemsUpdated",this).call(this,t)}},{key:"handleItemsRemoved",value:function(t){var e=this;t.keys.forEach(function(t){e.vnodesCache.delete(t)}),i(a(s.prototype),"handleItemsRemoved",this).call(this,t)}},{key:"handleModelRefresh",value:function(){this.vnodesCache.clear(),i(a(s.prototype),"handleModelRefresh",this).call(this)}},{key:"_log",value:function(t){p.info("[WaterfallLayoutContentHandler]=> "+t)}}]),s}(v.IteratingDataProviderContentHandler),_=function(e,n,i,o){var s,l=arguments.length,r=l<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,i):o;if("object"===("undefined"==typeof Reflect?"undefined":t(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,n,i,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(l<3?s(r):l>3?s(n,i,r):s(n,i))||r);return l>3&&r&&Object.defineProperty(n,i,r),r};n.WaterfallLayout=g=function(t){o(n,t);var e=l(n);function n(t){var i;return u(this,n),(i=e.call(this,t)).restoreFocus=!1,i.actionableMode=!1,i.renderCompleted=!1,i.ticking=!1,i.setRootElement=function(t){i.root=t},i.state={renderedData:null,positions:null,skeletonPositions:null,width:0,height:0,contentHeight:0},i}return c(n,[{key:"_handleFocusIn",value:function(t){this.currentItem&&this.focusInHandler(this.currentItem)}},{key:"_handleFocusOut",value:function(t){this.currentItem&&this.focusOutHandler(this.currentItem)}},{key:"_handleClick",value:function(t){this._handleTouchOrClickEvent(t)}},{key:"_handleKeyDown",value:function(t){if(this.currentItem){var e;switch(t.key){case"ArrowLeft":case"Left":e=this.currentItem.previousElementSibling;break;case"ArrowRight":case"Right":e=this.currentItem.nextElementSibling;break;case"F2":!1===this.actionableMode&&this._enterActionableMode();break;case"Escape":case"Esc":!0===this.actionableMode&&this._exitActionableMode();break;case"Tab":!0===this.actionableMode&&this.currentItem&&(t.shiftKey?r.handleActionablePrevTab(t,this.currentItem):r.handleActionableTab(t,this.currentItem))}!1===this.actionableMode&&null!=e&&e.classList.contains(this.getItemStyleClass())&&this._updateCurrentItem(e)}}},{key:"_touchStartHandler",value:function(t){this._handleTouchOrClickEvent(t)}},{key:"render",value:function(){var t;if(null==this.contentHandler)t=this._renderInitialSkeletons(null);else{var e=this.getData(),n=this.state.skeletonPositions;e?null!=n&&this.contentHandler.isInitialFetch()?t=this._renderInitialSkeletons(n.positions):(t=this.contentHandler.render(),this.currentItem&&this.currentItem.contains(document.activeElement)&&(this.restoreFocus=!0)):null!=n&&(t=this._renderInitialSkeletons(n.positions))}return f.h("oj-waterfall-layout",{ref:this.setRootElement,style:this._getRootElementStyle()},f.h("div",{onClick:this._handleClick,onKeydown:this._handleKeyDown,onTouchstart:this._touchStartHandler,onFocusin:this._handleFocusIn,onFocusout:this._handleFocusOut,role:"grid","aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"]},f.h("div",{role:"row",style:this._getContentDivStyle(),"data-oj-context":!0},t)))}},{key:"_getScrollPolicyOptions",value:function(){return{fetchSize:this.props.scrollPolicyOptions.fetchSize,maxCount:this.props.scrollPolicyOptions.maxCount,scroller:this._getScroller()}}},{key:"mounted",value:function(){var t=this,e=this.getRootElement();this.props.data&&(this.contentHandler=new b(e,this.props.data,this,this._getScrollPolicyOptions(),g.gutterWidth),this.contentHandler.fetchRows());var n=e.clientWidth,i=e.clientHeight;this.updateState({width:n,height:i});var o=e.querySelector(".oj-waterfalllayout-skeleton");if(o&&(this.skeletonWidth=o.clientWidth,this.contentHandler&&this._delayShowSkeletons()),window.ResizeObserver){var s=new window.ResizeObserver(function(n){n.forEach(function(n){if(n.target===e&&n.contentRect){var i=t.state.width,o=Math.round(n.contentRect.width);Math.abs(o-i)>g.minResizeWidthThreshold&&(t.updateState({width:o}),null!=t.getSkeletonPositions()?t._updatePositionsForSkeletons(o):null!=t.getPositions()&&t.contentHandler&&(t.contentHandler.getLayout().setWidth(o),t.renderCompleted&&t.contentHandler.handleResizeWidth(o)));var s=t.state.height,l=Math.round(n.contentRect.height);Math.abs(l-s)>1&&l!==t.state.contentHeight&&t.updateState({height:l})}})});s.observe(e),this.resizeObserver=s}m.makeFocusable({applyHighlight:!0,setupHandlers:function(e,n){var i=r.getNoJQFocusHandlers(e,n);t.focusInHandler=i.focusIn,t.focusOutHandler=i.focusOut}}),this._getScroller().addEventListener("scroll",this.scrollListener)}},{key:"_handleNewData",value:function(){this.updateState({renderedData:null,positions:null}),this.contentHandler&&this.contentHandler.destroy(),this.currentKey=null,this.currentItem=null;var t=this.getRootElement();this.contentHandler=new b(t,this.props.data,this,this._getScrollPolicyOptions(),g.gutterWidth),this.contentHandler.fetchRows(),this._delayShowSkeletons()}},{key:"updated",value:function(t,e){var n=this;if(null!=this.getData()){if(null==e.renderedData){var i=this._findSkeletons();i.length>0?this._applySkeletonExitAnimation(i).then(function(){n.updateState({skeletonPositions:null})}):(this.updateState({skeletonPositions:null}),this.contentHandler.postRender())}else if(this.props.data!=t.data){var o=this.addBusyState("apply exit animations on existing items");this._applyExitAnimation().then(function(){o(),n._handleNewData()})}else null==e.positions&&null!=this.state.positions?(this._applyEntranceAnimation(),!this.renderCompleted&&this.contentHandler&&this.contentHandler.postRender()):null!=e.positions&&null!=this.state.positions&&e.positions.size<this.state.positions.size?(this._applyLoadMoreEntranceAnimation(),!this.renderCompleted&&this.contentHandler&&this.contentHandler.postRender()):this.contentHandler&&this.contentHandler.postRender();s.Object.compareValues(this.props.scrollPosition,t.scrollPosition)||s.Object.compareValues(this.props.scrollPosition,this.lastInternalScrollPositionUpdate)||this._syncScrollTopWithProps()}else this.props.data&&null==t.data&&this._handleNewData()}},{key:"unmounted",value:function(){this.contentHandler&&this.contentHandler.destroy(),this.contentHandler=null,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null,this.scrollListener&&null!=this._getScroller()&&this._getScroller().removeEventListener("scroll",this.scrollListener)}},{key:"_delayShowSkeletons",value:function(){var t=this;window.setTimeout(function(){null==t.getData()&&t._updatePositionsForSkeletons(t.state.width)},this._getShowSkeletonsDelay())}},{key:"_updatePositionsForSkeletons",value:function(t){var e=this._getPositionsForSkeletons(50,t,this.skeletonWidth);this.updateState({skeletonPositions:e})}},{key:"_getOptionDefaults",value:function(){return null==this.defaultOptions&&(this.defaultOptions=d.parseJSONFromFontFamily("oj-waterfalllayout-option-defaults")),this.defaultOptions}},{key:"_getShowSkeletonsDelay",value:function(){var t=this._getOptionDefaults(),e=parseInt(t.showIndicatorDelay,10);return isNaN(e)?0:e}},{key:"addBusyState",value:function(t){var e=this.getRootElement();return y.getContext(e).getBusyContext().addBusyState({description:t})}},{key:"_isReady",value:function(){var t=this.getRootElement();return y.getContext(t).getBusyContext().isReady()}},{key:"_findSkeletons",value:function(){var t=this.getRootElement().querySelectorAll(".oj-waterfalllayout-skeleton");return t.length>1?t:[]}},{key:"getRootElement",value:function(){return this.root}},{key:"isAvailable",value:function(){return null!=this.contentHandler}},{key:"getCurrentItem",value:function(){return this.currentKey}},{key:"setCurrentItem",value:function(t){this.currentKey=t}},{key:"getData",value:function(){return this.state.renderedData}},{key:"setData",value:function(t){null!=t&&(this.renderCompleted=!1),this.updateState({renderedData:t});var e=this._findSkeletons();null!=t&&0!==e.length||this.updateState({skeletonPositions:null})}},{key:"updateData",value:function(t){this.updateState(function(e){var n=e.renderedData;return t(n)}.bind(this))}},{key:"getSkeletonPositions",value:function(){return this.state.skeletonPositions}},{key:"setSkeletonPositions",value:function(t){this.updateState({skeletonPositions:t})}},{key:"getPositions",value:function(){return this.state.positions}},{key:"setPositions",value:function(t){this.updateState({positions:t})}},{key:"setContentHeight",value:function(t){null!=this.props.scrollPolicyOptions.scroller&&this.updateState({contentHeight:t})}},{key:"getItemRenderer",value:function(){return this.props.itemTemplate}},{key:"getItemStyleClass",value:function(){return"oj-waterfalllayout-item"}},{key:"getExpanded",value:function(){}},{key:"_applySkeletonExitAnimation",value:function(t){var e=this.addBusyState("apply skeleton exit animations");return new Promise(function(n,i){var o;t.forEach(function(t){o=h.fadeOut(t)}),o&&o.then(function(){e(),n(!0)})})}},{key:"_applyEntranceAnimation",value:function(){var t=this.getRootElement().querySelectorAll("."+this.getItemStyleClass());if(0===t.length)return Promise.resolve(!0);var e=[];return t.forEach(function(t,n){var i=t;i.style.visibility="visible";var o=i.style.transition;i.style.transition="none";var s=Math.min(1e3,50*n)+"ms",l=h.slideIn(t,{offsetY:"300px",delay:s,duration:"300ms"});e.push(l),e.push(h.fadeIn(t,{delay:s,duration:"300ms"})),l.then(function(){i.style.transition=o})}),Promise.all(e)}},{key:"_applyExitAnimation",value:function(){var t=this.getRootElement().querySelectorAll("."+this.getItemStyleClass());if(0===t.length)return Promise.resolve(!0);var e=[];return t.forEach(function(t){e.push(h.slideOut(t,{offsetY:"300px",duration:"300ms",persist:"all"})),e.push(h.fadeOut(t,{duration:"300ms",persist:"all"}))}),Promise.all(e)}},{key:"_applyLoadMoreEntranceAnimation",value:function(){var t=this.getRootElement().querySelectorAll(".oj-waterfalllayout-new-item");if(0===t.length)return Promise.resolve(!0);var e=[];return t.forEach(function(t){t.classList.remove("oj-waterfalllayout-new-item"),e.push(h.fadeIn(t,{duration:"150ms"}))}),Promise.all(e)}},{key:"scrollListener",value:function(t){var e=this;this.ticking||(window.requestAnimationFrame(function(){e.isAvailable()&&e._updateScrollPosition(),e.ticking=!1}),this.ticking=!0)}},{key:"_updateScrollPosition",value:function(){for(var t,e,n,i=this._getScroller().scrollTop,o=this.contentHandler.getLayout().getPositions().entries(),s=o.next(),l=0;!s.done;){var r=s.value;s=o.next();var a=r[1].top;if(a>i){void 0===n&&(n=r[0]);break}a>l&&(n=r[0],l=a)}var u={y:i,key:n,offsetY:Math.abs(i-l)};this.lastInternalScrollPositionUpdate=u,null===(e=(t=this.props).onScrollPositionChanged)||void 0===e||e.call(t,u)}},{key:"_syncScrollTopWithProps",value:function(){var t,e=this.props.scrollPosition,n=e.key;if(n){var i=this.contentHandler.getLayout().getPosition(n);if(null==i)return;t=i.top;var o=e.offsetY;isNaN(o)||(t+=o)}else{var s=e.y;if(isNaN(s))return;t=s}t>this._getScroller().scrollHeight||(this._getScroller().scrollTop=t)}},{key:"_handleTouchOrClickEvent",value:function(t){var e=t.target.closest("."+this.getItemStyleClass());this._updateCurrentItem(e)}},{key:"_resetFocus",value:function(t){this.focusOutHandler(t),t.tabIndex=-1}},{key:"_setFocus",value:function(t,e){t.tabIndex=0,e&&(this.focusInHandler(t),t.focus())}},{key:"_updateCurrentItem",value:function(t){if(this.currentItem){var e=this.currentItem;this._resetFocus(e)}this.currentItem=t;var n=t;this.currentKey=n.key,this._setFocus(n,!0),this._scrollToVisible(n)}},{key:"_scrollToVisible",value:function(t){var e=t.offsetTop,n=t.offsetHeight,i=this._getScroller(),o=i.scrollTop,s=i.offsetHeight;if(!(e>=o&&e+n<=o+s)){var l=Math.max(0,Math.min(e,Math.abs(e+n-s)));i.scrollTop=l}}},{key:"_getScroller",value:function(){var t=this.props.scrollPolicyOptions.scroller;return"string"==typeof t&&(t=document.querySelector(t)),null!=t?t:this.getRootElement()}},{key:"_getContentDivStyle",value:function(){return{height:this.state.contentHeight+"px"}}},{key:"_getRootElementStyle",value:function(){return null!=this.props.scrollPolicyOptions.scroller?{overflow:"hidden"}:null}},{key:"_renderInitialSkeletons",value:function(t){var e=this._getScroller();if(null!=e&&(e.scrollTop=0),null==t)return this._renderSkeleton(null);for(var n=t.size,i=[],o=0;o<n;o++){var s=t.get(o);i.push(this._renderSkeleton(s))}return f.h("div",{role:"row"},i)}},{key:"_getPositionsForSkeletons",value:function(t,e,n){for(var i=[],o=new Map,s=0;s<t;s++){var l=150+s%3*100;o.set(s,{height:l}),i.push({key:s})}return new k(null,e,g.gutterWidth,n,o).getPositionForItems(i,0)}},{key:"_isInViewport",value:function(t){var e=parseInt(t.style.top,10),n=this._getScroller().scrollTop;return e>=n&&e<=n+this.state.height}},{key:"_restoreCurrentItem",value:function(t){if(null!=this.currentKey)for(var e=0;e<t.length;e++)if(s.KeyUtils.equals(t[e].key,this.currentKey)){var n=t[e].element;this.restoreFocus&&this._isInViewport(n)?this._updateCurrentItem(n):(this._setFocus(n,!1),this.currentItem=n);break}this.restoreFocus=!1}},{key:"_disableAllTabbableElements",value:function(t){t.forEach(function(t){r.disableAllFocusableElements(t.element,!0)})}},{key:"_enterActionableMode",value:function(){if(this.actionableMode=!0,this.currentItem){var t=r.enableAllFocusableElements(this.currentItem,!0);t&&t.length>0&&t[0].focus()}}},{key:"_exitActionableMode",value:function(){this.actionableMode=!1,this.currentItem&&(r.disableAllFocusableElements(this.currentItem,!0),this._setFocus(this.currentItem,!0))}},{key:"renderComplete",value:function(t){this.renderCompleted=!0,this.actionableMode=!1,this._disableAllTabbableElements(t),this._restoreCurrentItem(t)}},{key:"renderSkeletons",value:function(t){var e=this,n=[];return t.forEach(function(t){n.push(e._renderSkeleton(t))}),n}},{key:"_renderSkeleton",value:function(t){var e;return null==t?e={visibility:"hidden"}:(e={top:t.top+"px",left:t.left+"px",height:t.height+"px"},isNaN(t.width)||(e.width=t.width+"px")),f.h("div",{class:"oj-waterfalllayout-skeleton",style:e},f.h("div",{class:"oj-waterfalllayout-skeleton-content oj-animation-skeleton"}))}}]),n}(f.ElementVComponent),n.WaterfallLayout.gutterWidth=20,n.WaterfallLayout.minResizeWidthThreshold=10,n.WaterfallLayout.metadata={extension:{_DEFAULTS:function t(){u(this,t),this.data=null,this.scrollPolicy="loadMoreOnScroll",this.scrollPolicyOptions={fetchSize:25,maxCount:500,scroller:null},this.scrollPosition={y:0}},_ROOT_PROPS_MAP:{"aria-label":1,"aria-labelledby":1},_WRITEBACK_PROPS:["scrollPosition"],_READ_ONLY_PROPS:[]},properties:{data:{type:"object|null",value:null},scrollPolicy:{type:"string",enumValues:["loadAll","loadMoreOnScroll"],value:"loadMoreOnScroll"},scrollPolicyOptions:{type:"object",properties:{fetchSize:{type:"number",value:25},maxCount:{type:"number",value:500},scroller:{type:"Element|string|null",value:null}}},scrollPosition:{type:"object",properties:{y:{type:"number",value:0},key:{type:"any"},offsetY:{type:"number"}},writeback:!0}},slots:{itemTemplate:{data:{}}}},_([f.listener()],n.WaterfallLayout.prototype,"_handleFocusIn",null),_([f.listener()],n.WaterfallLayout.prototype,"_handleFocusOut",null),_([f.listener()],n.WaterfallLayout.prototype,"_handleClick",null),_([f.listener()],n.WaterfallLayout.prototype,"_handleKeyDown",null),_([f.listener({passive:!0})],n.WaterfallLayout.prototype,"_touchStartHandler",null),_([f.listener()],n.WaterfallLayout.prototype,"scrollListener",null),n.WaterfallLayout=g=_([f.customElement("oj-waterfall-layout")],n.WaterfallLayout),Object.defineProperty(n,"__esModule",{value:!0})})}();
//# sourceMappingURL=ojwaterfalllayout.js.map