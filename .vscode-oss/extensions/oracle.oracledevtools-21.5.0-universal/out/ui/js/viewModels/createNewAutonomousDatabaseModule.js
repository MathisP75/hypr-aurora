define(["require","exports","knockout","ojs/ojknockout-keyset","../common/dataAccessService","../common/localizedConstants","../common/scriptExecutionModels","../common/autonomousDBModels","ojs/ojarraytreedataprovider","../utilities","../common/messageService","../common/models","ojs/ojarraydataprovider","ojs/ojcore","ojs/ojcheckboxset","jquery","ojs/ojtreeview","ojs/ojarraytreedataprovider","ojs/ojbutton","ojs/ojknockout","ojs/ojinputtext","ojs/ojlabel","ojs/ojprogress","ojs/ojformlayout","ojs/ojselectcombobox","ojs/ojmessage","ojs/ojmessages","ojs/ojnavigationlist","ojs/ojcollapsible","ojs/ojlabelvalue","ojs/ojradioset","ojs/ojpopup","ojs/ojdialog","ojs/ojinputnumber","ojs/ojlistview","ojs/ojinputtext","ojs/ojknockout","ojs/ojbutton","ojs/ojformlayout"],(function(require,e,t,s,a,i,n,o,r,l,c,d,h){"use strict";let p;class u{constructor(){this.databaseInformation=i.LocalizedConstants.Instance.databaseInformation,this.changeCompartment=i.LocalizedConstants.Instance.changeCompartment,this.compartmentName=i.LocalizedConstants.Instance.compartmentName,this.displayName=i.LocalizedConstants.Instance.displayName,this.databaseName=i.LocalizedConstants.Instance.databaseName,this.ipAddress=i.LocalizedConstants.Instance.ipAddresses,this.databaseType=i.LocalizedConstants.Instance.databaseType,this.chooseWorkloadType=i.LocalizedConstants.Instance.chooseWorkloadType,this.dedicated=i.LocalizedConstants.Instance.dedicated,this.configureDatabase=i.LocalizedConstants.Instance.configureDatabase,this.alwaysFree=i.LocalizedConstants.Instance.alwaysFree,this.mTLSConnection=i.LocalizedConstants.Instance.mTLSConnection,this.cpuCoreCount=i.LocalizedConstants.Instance.cpuCoreCount,this.storage=i.LocalizedConstants.Instance.storage,this.autoScaling=i.LocalizedConstants.Instance.autoScaling,this.licenseType=i.LocalizedConstants.Instance.licenseType,this.bringyourOwnLicense=i.LocalizedConstants.Instance.bringyourOwnLicense,this.licenseIncluded=i.LocalizedConstants.Instance.licenseIncluded,this.secureAccessFromEveryWhere=i.LocalizedConstants.Instance.secureAccessFromEveryWhere,this.secureAccessFromAllowedIPs=i.LocalizedConstants.Instance.secureAccessFromAllowedIPs,this.adminCredentials=i.LocalizedConstants.Instance.adminCredentials,this.userName=i.LocalizedConstants.Instance.userName,this.password=i.LocalizedConstants.Instance.pswdStr,this.confirmpassword=i.LocalizedConstants.Instance.confirmPswd,this.createADB=i.LocalizedConstants.Instance.createADB,this.addIPAddress=i.LocalizedConstants.Instance.addIPAddress,this.chooseAutonomousContainerDB=i.LocalizedConstants.Instance.chooseAutonomousContainerDB,this.containerDB=i.LocalizedConstants.Instance.containerDB,this.requiredText=" *",this.compartmentSelected=i.LocalizedConstants.Instance.compartmentSelected,this.noContainerAvailable=i.LocalizedConstants.Instance.noContainerAvailable,this.noDatabaseVersionAvailable=i.LocalizedConstants.Instance.noDatabaseVersionAvailable,this.dataWareHouse=i.LocalizedConstants.Instance.dataWareHouse,this.dataWareHouseDescription=i.LocalizedConstants.Instance.dataWareHouseDescription,this.transactionProcessing=i.LocalizedConstants.Instance.transactionProcessing,this.transactionProcessingDescription=i.LocalizedConstants.Instance.transactionProcessingDescription,this.json=i.LocalizedConstants.Instance.json,this.jsonDescription=i.LocalizedConstants.Instance.jsonDescription,this.chooseDeploymentType=i.LocalizedConstants.Instance.chooseDeploymentType,this.sharedInfrastructure=i.LocalizedConstants.Instance.sharedInfrastructure,this.sharedInfrastructureDesc=i.LocalizedConstants.Instance.sharedInfrastructureDesc,this.dedicatedInfrastructure=i.LocalizedConstants.Instance.dedicatedInfrastructure,this.dedicatedInfrastructureDesc=i.LocalizedConstants.Instance.dedicatedInfrastructureDesc,this.alwaysFreeDescription=i.LocalizedConstants.Instance.alwaysFreeDescription,this.nonFreecpuCoreCountDesc=i.LocalizedConstants.Instance.nonFreecpuCoreCountDesc,this.freecpuCoreCountDesc=i.LocalizedConstants.Instance.freecpuCoreCountDesc,this.nonFreeStorageDesc=i.LocalizedConstants.Instance.nonFreeStorageDesc,this.freeStorageDesc=i.LocalizedConstants.Instance.freeStorageDesc,this.adminUserDescription=i.LocalizedConstants.Instance.adminUserDescription,this.readonly=i.LocalizedConstants.Instance.readonly,this.pswdPattern=i.LocalizedConstants.Instance.pswdPattern,this.emptyPswd=i.LocalizedConstants.Instance.emptyPswd,this.pswdMismatch=i.LocalizedConstants.Instance.pswdMismatch,this.adbNameDescription=i.LocalizedConstants.Instance.adbNameDescription,this.adbInvalidDisplayName=i.LocalizedConstants.Instance.adbInvalidDisplayName,this.adbInvalidName=i.LocalizedConstants.Instance.adbInvalidName,this.adbConnectionUIHeader=i.LocalizedConstants.Instance.adbConnectionUIHeader,this.adbATPText=i.LocalizedConstants.Instance.adbATPText,this.adbDWText=i.LocalizedConstants.Instance.adbDWText,this.adbJSONText=i.LocalizedConstants.Instance.adbJSONText,this.db19C=i.LocalizedConstants.Instance.db19C,this.db21C=i.LocalizedConstants.Instance.db21C,this.workloadTypeText=i.LocalizedConstants.Instance.workloadTypeText,this.deploymentTypeText=i.LocalizedConstants.Instance.deploymentTypeText,this.licenseTypeText=i.LocalizedConstants.Instance.licenseTypeText,this.networkAccessTypeText=i.LocalizedConstants.Instance.networkAccessTypeText,this.databaseVersionText=i.LocalizedConstants.Instance.databaseVersionText,this.profileName=i.LocalizedConstants.Instance.profile,this.OK=i.LocalizedConstants.Instance.OK,this.compartmentFullPath=i.LocalizedConstants.Instance.compartmentFullPath,this.ocpuError=i.LocalizedConstants.Instance.ocpuError,this.storageError=i.LocalizedConstants.Instance.storageError,this.invalidValueError=i.LocalizedConstants.Instance.invalidValue,this.selectCompartmentForContainerdb=i.LocalizedConstants.Instance.selectCompartmentForContainerdb,this.currentSelection=i.LocalizedConstants.Instance.currentSelection,this.compartmentNameForContainerDB=i.LocalizedConstants.Instance.compartmentNameForContainerDB,this.updateCompartment=i.LocalizedConstants.Instance.updateCompartment,this.selectNewCompartment=i.LocalizedConstants.Instance.selectNewCompartment,this.cancel=i.LocalizedConstants.Instance.cancel,this.adbNameAlreadyInUse=i.LocalizedConstants.Instance.adbNameUsedInAnotherPage,this.yes=i.LocalizedConstants.Instance.yes,this.no=i.LocalizedConstants.Instance.no,this.update=i.LocalizedConstants.Instance.update,this.add=i.LocalizedConstants.Instance.add,this.remove=i.LocalizedConstants.Instance.remove,this.addMyIPAddress=i.LocalizedConstants.Instance.addMyIPAddress}}return class{constructor(){this.msgPos={my:{vertical:"top",horizontal:"end"},at:{vertical:"top",horizontal:"end"},of:"window"},this.createADBUILabelText=new u,this.compartmentFullNameForDisplay=t.observable(""),this.profileName=t.observable(""),this.displayName=t.observable(""),this.databaseName=t.observable(""),this.ipAddress=t.observable(""),this.databaseType=t.observable(""),this.cpuCoreCount=t.observable(1),this.storage=t.observable(1),this.userName=t.observable("ADMIN"),this.password=t.observable(""),this.confirmpassword=t.observable(""),this.licenseType=t.observable(o.ADBLicenseType.BringYourLicense),this.networkAccessType=t.observable(o.ADBNetworkAccessType.SecureAccessFromEveryWhere),this.adbworkLoadType=t.observable(o.ADBworkLoadType.OLTP),this.deploymentType=t.observable(o.ADBDeploymentType.SharedInfrastructure),this.databaseVersion=t.observable(""),this.compartmentData=t.observable(),this.rootTenancy=t.observable(),this.currentCompartmentID=t.observable(""),this.currentCompartmentName=t.observable(""),this.currentCompartmentFullName=t.observable(),this.selectedCompartmentID=t.observable(""),this.selectedCompartmentName="",this.selectedCompartmentFullName="",this.compartmentNameForDedicatedInfra=t.observable(""),this.compartmentArrayTree=[],this.selected=new s.ObservableKeySet,this.expanded=new s.ObservableKeySet,this.data=t.observable(null),this.showcheckBoxes=t.observable(!0),this.containerDatabases=t.observableArray(),this.selectedContainerDatabase=t.observable(null),this.pswderror=t.observable(""),this.pswdMismatchError=t.observable(""),this.ocpuError=t.observable(""),this.storageError=t.observable(""),this.inValidValueError=t.observable(""),this.inValidIPAddressValueErrorInDialog=t.observable(""),this.pageinitialized=!1,this.dbNameError=t.observable(""),this.dbDisplayNameError=t.observable(""),this.createADB2=t.observable(),this.selectCompartmentForProfile=t.observable(""),this.region="",this.isCreateInProgress=t.observable(!1),this.disableAutoScaling=t.observable(!1),this.validNetworkAccessType=()=>{let e=!0;return e=0==this.inValidValueError().length||this.networkAccessType()==o.ADBNetworkAccessType.SecureAccessFromAllowedIPs&&this.ipAddress().length>=0&&0==this.inValidValueError().length,e},this.showContainerDBControls=t.pureComputed(()=>this.isDedicated()),this.showOCPUError=t.pureComputed(()=>{let e=this.ocpuError().length>0;return this.pageinitialized||(e=!1),e}),this.showStorageError=t.pureComputed(()=>{let e=this.storageError().length>0;return this.pageinitialized||(e=!1),e}),this.showdbNameError=t.pureComputed(()=>{let e=this.dbNameError().length>0;return this.pageinitialized||(e=!1),e}),this.showdbDisplayNameError=t.pureComputed(()=>{let e=this.dbDisplayNameError().length>0;return this.pageinitialized||(e=!1),e}),this.showPasswordMismatchError=t.pureComputed(()=>{let e=this.pswdMismatchError().length>0;return this.pageinitialized||(e=!1),e}),this.showInvalidPasswordError=t.pureComputed(()=>{let e=this.pswderror().length>0;return this.pageinitialized||(e=!1),e}),this.disableDeploymentTypesOption=t.observable(!1),this.disableLicenseTypesOption=t.observable(!1),this.disableNetworkAccessControls=t.observable(!1),this.showAlwaysFreeOption=t.pureComputed(()=>!this.isDedicated()),this.sharedDeploymentType=t.pureComputed(()=>this.deploymentType()==o.ADBDeploymentType.SharedInfrastructure),this.validDatabaseName=e=>{let t=new RegExp("^[a-zA-Z][a-zA-Z0-9]{0,}$");return null!=e.match(t)},this.onOCPUCount=e=>{if(this.pageinitialized){let t=e.detail.value;this.isIntegerInRange(t)?this.ocpuError(""):this.ocpuError(this.createADBUILabelText.ocpuError)}},this.onStorage=e=>{if(this.pageinitialized){let t=e.detail.value;this.isAlwaysFree()||this.isNumberInRange(t)?this.storageError(""):this.storageError(this.createADBUILabelText.storageError)}},this.currentDatabaseName="",this.onDatabaseName=e=>{if(this.pageinitialized){let t=e.detail.value;this.currentDatabaseName=t;let s="";this.validDatabaseName(t)?(s=t,this.dbNameError("")):this.dbNameError(this.createADBUILabelText.adbInvalidName),this.updatePageTitle(s)}},this.onDatabaseDisplayName=e=>{if(this.pageinitialized){let t=e.detail.value;this.validDatabaseDisplayName(t)?this.dbDisplayNameError(""):this.dbDisplayNameError(this.createADBUILabelText.adbInvalidDisplayName)}},this.onConfirmPswdProvided=e=>{let t=e.detail.value;this.confirmpassword(t),(0!=t.length||this.pageinitialized)&&this.setPswdMismatchError(this.password(),t)},this.showAutoScaling=t.pureComputed(()=>!this.isDedicated()),this.findNode=(e,s)=>{const a=t.isObservable(e)?e():e;for(let e=0;e<a.length;e+=1){if(a[e].id==s)return a[e];if(a[e].children){const t=this.findNode(a[e].children,s);if(t)return t}}},this.onPswdProvided=e=>{let t=e.detail.value;(0!=t.length||this.pageinitialized)&&(this.confirmpassword(""),this.pswdMismatchError(""),this.validPswd(t)||0==t.length?this.pswderror(""):this.pswderror(this.createADBUILabelText.pswdPattern))},this.launchSelectCompartmentsDialog=()=>{document.getElementById("selectCompartmentDialogID").open()},this.disableConfigureDBControls=t.pureComputed(()=>{let e=null==this.alwaysFree()||0!=this.alwaysFree().length;return this.resetConfigureDBControlsValues(e),e}),this.resetConfigureDBControlsValues=e=>{e?(this.prevCPUCoreCount=this.cpuCoreCount(),this.prevstorage=this.storage(),this.cpuCoreCount(1),this.storage(.02)):(this.cpuCoreCount(this.prevCPUCoreCount),this.storage(this.prevstorage))},this.databaseVersions=t.observableArray(),this.workLoadTypes=t.observableArray([{value:o.ADBworkLoadType.OLTP,label:this.createADBUILabelText.adbATPText},{value:o.ADBworkLoadType.DW,label:this.createADBUILabelText.adbDWText},{value:o.ADBworkLoadType.AJD,label:this.createADBUILabelText.adbJSONText}]),this.licenseTypes=t.observableArray([{value:o.ADBLicenseType.BringYourLicense,label:this.createADBUILabelText.bringyourOwnLicense},{value:o.ADBLicenseType.SubscribeToNewLicense,label:this.createADBUILabelText.licenseIncluded}]),this.networkAccessTypes=t.observableArray([{value:o.ADBNetworkAccessType.SecureAccessFromEveryWhere,label:this.createADBUILabelText.secureAccessFromEveryWhere},{value:o.ADBNetworkAccessType.SecureAccessFromAllowedIPs,label:this.createADBUILabelText.secureAccessFromAllowedIPs}]),this.deploymentTypes=t.observableArray([{value:o.ADBDeploymentType.SharedInfrastructure,label:this.createADBUILabelText.sharedInfrastructure},{value:o.ADBDeploymentType.DedicatedInfrastructure,label:this.createADBUILabelText.dedicatedInfrastructure}]),this.selectedChanged=e=>{if(e&&e.detail&&e.detail.value&&e.detail.value.values().size>0){var t=[];e.detail.value.values().forEach((function(e){t.push(e)}));var s=this.findNode(this.compartmentArrayTree,t[0]);null!=s&&null!=s.fullPath&&(this.selectedCompartmentID(s.id),this.selectedCompartmentName=s.nameForDisplay,this.selectedCompartmentFullName=s.fullNameForDisplay)}},this.okButtonDisabled=t.pureComputed(()=>{let e=!0;return this.currentCompartmentID()!==this.selectedCompartmentID()&&(e=!1),e},this),this.onOKCompartment=()=>{document.getElementById("selectCompartmentDialogID").close(),this.currentCompartmentID(this.selectedCompartmentID()),this.currentCompartmentName(this.selectedCompartmentName),this.currentCompartmentFullName(this.selectedCompartmentFullName),this.compartmentNameForDedicatedInfra(this.selectedCompartmentFullName),this.getAutonomousContainerDatabases(this.selectedCompartmentID(),this.selectedCompartmentFullName)},this.onCancelCompartment=()=>{document.getElementById("selectCompartmentDialogID").close()},this.onAutonomousContainerDatabasesReceived=e=>{this.disableDeploymentTypesOption(!1),this.isCreateInProgress(!1);let t=e.data;if(this.containerDatabases.removeAll(),0==t.adbContainerDatabases.length){let e=new o.autonomousContainerDBResponse;e.displayName=this.createADBUILabelText.noContainerAvailable,this.containerDatabases.push({value:e,label:this.createADBUILabelText.noContainerAvailable}),this.selectedContainerDatabase(e)}else{let e=null;for(let s=0;s<t.adbContainerDatabases.length;s++)e=t.adbContainerDatabases[s],this.containerDatabases.push({value:t.adbContainerDatabases[s],label:e.displayName});this.selectedContainerDatabase(t.adbContainerDatabases[0])}},this.getAutonomousContainerDatabases=(e,t)=>{a.DataAccessService.instance.logInfo("getAutonomousContainerDatabases request received.");var s=new n.MessageBase;s.type=n.MessageName.autonomousContainerDBRequestMessage;var i=new o.autonomousContainerDBRequest;i.windowUri=a.DataAccessService.instance.windowUri,i.compartmentID=e,i.compartmentName=t,i.profileName=a.DataAccessService.instance.profileName,i.workloadType=this.adbworkLoadType(),i.executionId=a.DataAccessService.instance.currentExecutionId,s.data=i;try{a.DataAccessService.instance.logInfo("Sending autonomousContainerDBrequest."),a.DataAccessService.instance.send(s),a.DataAccessService.instance.logInfo("Successfully placed autonomousContainerDBrequest")}catch(e){a.DataAccessService.instance.logError(e)}},this.onCompartmentsDataReceived=e=>{var t=e,s=JSON.parse(t.compartmentList),a=t.rootNodeName;if(this.rootTenancy(a),t&&t.compartmentList&&(this.compartmentArrayTree.push(s),this.data(new r(this.compartmentArrayTree,{keyAttributes:"id"}))),t.compartmentToselect){this.selected.add([t.compartmentToselect]),null!=t.ancestorList&&t.ancestorList.length>0&&(t.ancestorList=t.ancestorList.slice(0,-1),this.expanded.add(t.ancestorList));var i=this.findNode(this.compartmentArrayTree,t.compartmentToselect);i&&(this.currentCompartmentID(i.id),this.currentCompartmentName(i.nameForDisplay),this.currentCompartmentFullName(i.fullNameForDisplay),this.selectedCompartmentID(i.id),this.selectedCompartmentName=i.nameForDisplay,this.selectedCompartmentFullName=i.fullNameForDisplay)}else this.selected.add([t.rootNodeID])},this.enableCreatebutton=t.pureComputed(()=>{var e=!1;return 0==this.dbNameError().length&&0==this.pswderror().length&&0==this.pswdMismatchError().length&&this.confirmpassword().length>0&&this.validDatabaseContainer()&&this.validDatabaseVersion()&&0==this.ocpuError().length&&0==this.storageError().length&&0==this.dbDisplayNameError().length&&this.validNetworkAccessType()&&(!this.isDedicated()||this.currentCompartmentID()&&this.validDatabaseContainer())&&(e=!0),e},this),this.licenseOptions=[{id:"ownLicenseopt",value:"ownLicense",displayValue:this.createADBUILabelText.bringyourOwnLicense},{id:"subToNewLicenseopt",value:"subToNewLicense",displayValue:this.createADBUILabelText.licenseIncluded}],this.isMtlsConnectionRequired=t.observable(!0),this.handlersField=new Map,this.onCreateNewAutonomousDBResponseReceived=e=>{e.data.operationSucceeded||(this.isCreateInProgress(!1),this.password(""),this.confirmpassword(""),this.pswderror(""),this.pswdMismatchError(""),this.configureADBModuleCreateADBProgressHandler&&this.configureADBModuleCreateADBProgressHandler(!1))},this.onCreateNewAutonomousDBInitializationDataReceived=e=>{var t=e.data;this.compartmentFullNameForDisplay(t.compartmentFullPathForDisplay),this.compartmentID=t.compartmentID,this.displayName(t.displayName),this.databaseName(t.dbName),this.cpuCoreCount(t.cpuCoreCount),this.storage(t.storage),this.userName(t.userName),this.adbworkLoadType(t.workLoadType),this.onCompartmentsDataReceived(t.compartmentData),this.profileName(t.profileName),this.prevCPUCoreCount=this.cpuCoreCount(),this.prevstorage=this.storage(),t.autoScaling&&this.autoScaling.push("yes"),t.alwaysFree&&this.alwaysFree.push("yes"),t.isMtlsConnectionRequired?this.mTLSConnection.push("yes"):this.mTLSConnection.push("no"),this.pageinitialized=!0,this.dbVersionListForWorkload.setMap(o.dbVersionsForWorkloadNode.getMap(t.dbVersionJSONDataForWorkloadNode)),this.populateSupportedDatabaseVersionComboBox(this.adbworkLoadType(),!0),this.selectCompartmentForProfile(`${i.LocalizedConstants.Instance.changeCompartment} For Profile - '${t.profileName}'`),this.compartmentNameForDedicatedInfra(t.compartmentFullPathForDisplay),this.region=t.region},this.getCreateNewAutonomousDBInitializationData=()=>{a.DataAccessService.instance.logInfo("get CreateNewAutonomousDBInitializationData request received.");var e=new n.MessageBase;e.type=n.MessageName.initializeCreateNewAutonomousDBPageRequestMessage;var t=new o.initializeCreateNewAutonomousDBPageRequest;t.executionId=a.DataAccessService.instance.currentExecutionId,t.windowUri=a.DataAccessService.instance.windowUri,t.profileName=a.DataAccessService.instance.profileName,t.workloadType=a.DataAccessService.instance.adbWorkLoadType,e.data=t;try{a.DataAccessService.instance.send(e),a.DataAccessService.instance.logInfo("Successfully placed get CreateNewAutonomousDBInitializationData request")}catch(e){a.DataAccessService.instance.logError(e)}},this.isDedicated=()=>this.deploymentType()==o.ADBDeploymentType.DedicatedInfrastructure,this.validDatabaseVersion=()=>{let e=!0;return this.databaseVersion()==this.createADBUILabelText.noDatabaseVersionAvailable&&(e=!1),e},this.validDatabaseContainer=()=>{let e=!0;return this.isDedicated()&&this.selectedContainerDatabase().displayName==this.createADBUILabelText.noContainerAvailable&&(e=!1),e},this.ownedADBName=void 0,this.onCreateNewAutonomousDatabase=(e,t,s)=>{a.DataAccessService.instance.logInfo("get onCreateNewAutonomousDatabase request received."),this.ownedADBName=this.databaseName();var r=new n.MessageBase;r.type=n.MessageName.ociCreateNewATPDBRequestMessage;var h=new o.createNewAutonomousDBRequest;let p=this.isDedicated(),u=null==this.alwaysFree()||0!=this.alwaysFree().length;h.executionId=a.DataAccessService.instance.currentExecutionId,h.windowUri=a.DataAccessService.instance.windowUri,h.compartmentID=this.compartmentID,h.dbName=this.databaseName(),h.displayName=this.displayName(),h.profileName=this.profileName(),h.compartmentFullPath=this.compartmentFullNameForDisplay(),this.storage()?h.storage=u?1:this.storage():h.storage=1,this.cpuCoreCount()?h.cpuCoreCount=this.cpuCoreCount():h.cpuCoreCount=1,h.password=l.toCodePointArray(this.password()),h.dedicated=p,h.autonomousContainerDatabaseId=null,p?(h.isAccessControlEnabled=this.isAccessControlEnabled,this.whitelistedIps.length>0&&(h.whitelistedIps=this.whitelistedIps),a.DataAccessService.instance.logInfo("In request to create dedicated instance"),a.DataAccessService.instance.logInfo("containerDatabases length: "+this.containerDatabases.length),this.containerDatabases().length>0&&null!=this.selectedContainerDatabase()&&(a.DataAccessService.instance.logInfo("Selected container db display name: "+this.selectedContainerDatabase().displayName),h.autonomousContainerDatabaseId=this.selectedContainerDatabase().containerDatabaseID)):(h.isMtlsConnectionRequired=this.isMtlsConnectionRequired(),h.whitelistedIps=this.networkAccessType()==o.ADBNetworkAccessType.SecureAccessFromAllowedIPs?this.whitelistedIps:[" "]),h.alwaysFree=u,h.autoScaling=null==this.autoScaling()||0!=this.autoScaling().length,h.licenseType=this.licenseType(),h.workLoadType=this.adbworkLoadType(),h.dbVersion=this.databaseVersion(),h.region=this.region,r.data=h;try{a.DataAccessService.instance.send(r),a.DataAccessService.instance.logInfo("Successfully placed createNewAutonomousDatabase request"),this.isCreateInProgress(!0),this.configureADBModuleCreateADBProgressHandler&&this.configureADBModuleCreateADBProgressHandler(!0),c.MessagesService.getinstance().ClearAll(),c.MessagesService.getinstance().ShowMessageDetailed(i.LocalizedConstants.Instance.closeCreateAutonomousDbUI,d.Severity.info,-1)}catch(e){a.DataAccessService.instance.logError(e)}},this.workLoadTypeChangedHandler=e=>{if(this.pageinitialized){this.deploymentTypes.removeAll(),this.licenseTypes.removeAll();let e=this.isAlwaysFree();this.populateSupportedDatabaseVersionComboBox(this.adbworkLoadType(),e),this.updateDeploymentType(e,this.adbworkLoadType()),this.updateLicenseType(e,this.adbworkLoadType())}},this.showIPAddressControls=t.observable(!1),this.disableAuthenticationControl=t.observable(!0),this.licenseTypeChangedHandler=e=>{},this.containerDBChangedHandler=e=>{},this.onAlwaysFreeValueChanged=e=>{if(this.pageinitialized&&e&&e.detail){this.licenseTypes.removeAll();let t=null==e.detail.value||0!=e.detail.value.length;this.updateDeploymentType(t,this.adbworkLoadType()),this.updateLicenseType(t,this.adbworkLoadType()),this.populateSupportedDatabaseVersionComboBox(this.adbworkLoadType(),t),t?(this.autoScaling.removeAll(),this.disableAutoScaling(!0)):this.disableAutoScaling(!1)}},this.onmTLSValueChanged=e=>{if(this.pageinitialized&&e&&e.detail){this.licenseTypes.removeAll();let t=null==e.detail.value||0!=e.detail.value.length;this.updateDeploymentType(t,this.adbworkLoadType()),this.updateLicenseType(t,this.adbworkLoadType()),this.populateSupportedDatabaseVersionComboBox(this.adbworkLoadType(),t),t?(this.autoScaling.removeAll(),this.disableAutoScaling(!0)):this.disableAutoScaling(!1)}},this.deploymentTypeChangedHandler=e=>{this.pageinitialized&&this.deploymentType()==o.ADBDeploymentType.DedicatedInfrastructure&&(this.getAutonomousContainerDatabases(this.selectedCompartmentID(),this.compartmentNameForDedicatedInfra()),this.disableDeploymentTypesOption(!0))},this.databaseVersionChangedHandler=e=>{},this.updateNetworkAccessControls=e=>{e&&(this.networkAccessType(e.networkAccessType),this.isMtlsConnectionRequired(e.isMtlsConnectionRequired))},this.aclModuleDataHandler=e=>{this.whitelistedIps=e},this.isAccessControlEnabled=!1,this.enableDBLevelAccessControlHandler=e=>{this.isAccessControlEnabled=e},this.createADBPageHandler=e=>{this.configureADBModuleCreateADBProgressHandler=e},this.transitionCompleted=()=>{this.getCreateNewAutonomousDBInitializationData(),$("oj-combobox-one").on("cut paste",(function(e){e.preventDefault()})),$("oj-combobox-one").on("contextmenu",(function(e){return!1}))},this.onThemeChanged=e=>{a.DataAccessService.instance.logInfo("Theme Changed"),l.setContrast()},this.dbnameUsedInAnotherwindow=!1,this.onUsedADBNamesUpdatedMessage=e=>{if(this.isCreateInProgress()||!this.pageinitialized)return;let t=this.currentDatabaseName;if(t&&!this.validDatabaseName(t))return;let s=e.data;if(s&&t)for(const e in s.usedADBNames){const i=s.usedADBNames[e];if(e!==a.DataAccessService.instance.currentExecutionId&&i===t&&i!==this.ownedADBName)return this.dbNameError(this.createADBUILabelText.adbNameAlreadyInUse),void(this.dbnameUsedInAnotherwindow=!0)}this.dbnameUsedInAnotherwindow&&(this.dbnameUsedInAnotherwindow=!1,this.dbNameError(""))},this.ipAddresses=t.observableArray(),this.lastItemId=this.ipAddresses().length,this.ipAddressDataProvider=new h(this.ipAddresses,{keyAttributes:"id"}),this.inputIPAddress=t.observable(""),this.selectedItems=new s.ObservableKeySet,this.isTextEmpty=t.observable(!0),this.IPAddressRawValueChanged=e=>{const t=e.detail.value;this.isIPAddressEmpty(0===t.trim().length),this.validIPAddress(t)?this.inValidIPAddressValueErrorInDialog(""):this.inValidIPAddressValueErrorInDialog(this.createADBUILabelText.invalidValueError)},this.onIPAddressChange=e=>{if(this.pageinitialized){let t=e.detail.value;this.validIPAddress(t)?this.inValidValueError(""):this.inValidValueError(this.createADBUILabelText.invalidValueError)}},this.handleCurrentItemChanged=e=>{const t=e.detail.value,s=this.ipAddresses();for(let e=0;e<s.length;e++)if(s[e].id===t){this.currentIndex=e,this.inputIPAddress(s[e].item);break}},this.onRemoveIPAddressSelected=()=>{this.selectedItems().values().forEach(e=>{this.ipAddresses.remove(t=>t.id===e)})},this.onPublicIPAddressReceived=e=>{let t=e.data;this.inputIPAddress(t.ipAddress)},this.onOKUpdateIPAddressDialog=()=>{let e="";if(this.ipAddresses&&this.ipAddresses())for(let t=0;t<this.ipAddresses().length;t++)t>0&&(e+=","),e+=this.ipAddresses()[t].item;document.getElementById("changeIPAddressDialogID").close(),this.ipAddress(e)},this.onCancelIPAddressDialog=()=>{document.getElementById("changeIPAddressDialogID").close()},this.onAddIPAddress=()=>{const e=this.inputIPAddress();""!==e&&(this.lastItemId++,this.ipAddresses.push({id:this.lastItemId,item:e})),this.inputIPAddress("")},this.onAddMyIPAddress=()=>{a.DataAccessService.instance.logInfo("getpublicIPAddress request received.");var e=new n.MessageBase;e.type=n.MessageName.ociGetPublicIPAddressRequesttMessage;var t=new o.GetPublicIPAddressRequest;t.windowUri=a.DataAccessService.instance.windowUri,t.executionId=a.DataAccessService.instance.currentExecutionId,e.data=t;try{a.DataAccessService.instance.logInfo("Sending getpublicIPAddress."),a.DataAccessService.instance.send(e),a.DataAccessService.instance.logInfo("Successfully placed getpublicIPAddress")}catch(e){a.DataAccessService.instance.logError(e)}},this.isIPAddressEmpty=t.observable(!0),this.isSelectionEmpty=t.observable(!1),this.isTextOrSelectionEmpty=t.computed(()=>this.isIPAddressEmpty()||this.isSelectionEmpty()),this.showInValidValueError=t.pureComputed(()=>{let e=this.inValidValueError().length>0;return this.pageinitialized||(e=!1),e}),this.showInValidIPAddressValueErrorInDialog=t.pureComputed(()=>this.inValidIPAddressValueErrorInDialog().length>0),this.onUpdateIPAddress=e=>{this.ipAddresses.removeAll(),this.inputIPAddress(""),document.getElementById("changeIPAddressDialogID").open();let t=this.getIPAddressList(this.ipAddress());if(t&&t.length>0)for(let e=0;e<t.length;e++)this.ipAddresses.push({id:e,item:t[e]})},this.showChangeACLRuleModule=t.observable(!1),p=this,p.whitelistedIps=new Array,p.alwaysFree=t.observableArray(),p.mTLSConnection=t.observableArray(),p.autoScaling=t.observableArray(),p.dbVersionListForWorkload=new o.dbVersionsForWorkloadNode,p.handlers=new Map,p.handlers.set(n.MessageName.themeChanged,p.onThemeChanged),p.handlers.set(n.MessageName.odtConfigChanged,p.onConfigChanged),p.handlers.set(n.MessageName.initializeCreateNewAutonomousDBPageResponseMessage,p.onCreateNewAutonomousDBInitializationDataReceived),p.handlers.set(n.MessageName.autonomousContainerDBResponseMessage,p.onAutonomousContainerDatabasesReceived),p.handlers.set(n.MessageName.createNewAutonomousDBResponseMessage,p.onCreateNewAutonomousDBResponseReceived),p.handlers.set(n.MessageName.usedADBNamesUpdatedMessage,p.onUsedADBNamesUpdatedMessage),p.handlers.set(n.MessageName.ociGetPublicIPAddressResponseMessage,p.onPublicIPAddressReceived),a.DataAccessService.instance.subscribe(e=>{if(e&&this.handlers.get(e.type)){const t=this.handlers.get(e.type);t&&t(e)}else a.DataAccessService.instance.logError("Could not find handler for message "+e.type)}),a.DataAccessService.instance.logInfo("Fetching Localized resources "),a.DataAccessService.instance.getLocalizedData().done(e=>{a.DataAccessService.instance.logInfo("Fetched localized resources."),i.LocalizedConstants.Instance.Configure(e)}).fail(e=>{a.DataAccessService.instance.logError("Localized resources "+JSON.stringify(e))}),l.setContrast()}isAlwaysFree(){return null==this.alwaysFree()||0!=this.alwaysFree().length}isIntegerInRange(e){let t=!1;if(isNaN(e))t=!1;else{let s=Number(e).valueOf();t=!!(s>=1&&s<=128&&Number.isInteger(s))}return t}isNumberInRange(e){let t=!1;if(isNaN(e))t=!1;else{let s=Number(e).valueOf();t=s>=1&&s<=128}return t}updatePageTitle(e){a.DataAccessService.instance.logInfo("Sending request to update webview page caption");var t=new n.MessageBase;t.type=n.MessageName.updateAutonomousDBNameRequestMessage;var s=new o.updateAutonomousDBNameRequest;s.executionId=a.DataAccessService.instance.currentExecutionId,s.windowUri=a.DataAccessService.instance.windowUri,s.dbName=e,t.data=s;try{a.DataAccessService.instance.send(t),a.DataAccessService.instance.logInfo("Successfully placed request to update webview page caption")}catch(e){a.DataAccessService.instance.logError(e)}}setPswdMismatchError(e,t){0==t.length?this.pswdMismatchError(""):this.pswdMismatchError(this.passwordMatches(e,t)?"":this.createADBUILabelText.pswdMismatch)}passwordMatches(e,t){return e===t}validPswd(e){let t=new RegExp('^(?=(.*[0-9]){1,})(?=(.*[a-z]){1,})(?=(.*[A-Z]){1,})(?!(.*["]))(?!(.*[aA][dD][mM][iI][nN])).{12,30}$');return null!=e.match(t)}validDatabaseDisplayName(e){let t=new RegExp("^[a-zA-Z_](?!.*--)[a-zA-Z0-9_-]{0,}$");return null!=e.match(t)}get handlers(){return this.handlersField}set handlers(e){this.handlersField=e}setLicenseIncludedLicenseType(){this.licenseTypes.push({value:o.ADBLicenseType.SubscribeToNewLicense,label:this.createADBUILabelText.licenseIncluded}),this.licenseType(o.ADBLicenseType.SubscribeToNewLicense),this.disableLicenseTypesOption(!0)}setDefaultLicenseType(){this.licenseTypes.push({value:o.ADBLicenseType.BringYourLicense,label:this.createADBUILabelText.bringyourOwnLicense}),this.licenseTypes.push({value:o.ADBLicenseType.SubscribeToNewLicense,label:this.createADBUILabelText.licenseIncluded}),this.licenseType(o.ADBLicenseType.BringYourLicense),this.disableLicenseTypesOption(!1)}updateLicenseType(e,t){this.licenseTypes.removeAll(),e||t==o.ADBworkLoadType.AJD||this.isDedicated()?this.setLicenseIncludedLicenseType():this.setDefaultLicenseType()}setOnlySharedDeploymentType(){this.deploymentTypes.push({value:o.ADBDeploymentType.SharedInfrastructure,label:this.createADBUILabelText.sharedInfrastructure}),this.deploymentType(o.ADBDeploymentType.SharedInfrastructure),this.disableDeploymentTypesOption(!0)}setDefaultDeploymentTypes(){this.deploymentTypes.push({value:o.ADBDeploymentType.SharedInfrastructure,label:this.createADBUILabelText.sharedInfrastructure}),this.deploymentTypes.push({value:o.ADBDeploymentType.DedicatedInfrastructure,
label:this.createADBUILabelText.dedicatedInfrastructure}),this.deploymentType(o.ADBDeploymentType.SharedInfrastructure),this.disableDeploymentTypesOption(!1)}updateDeploymentType(e,t){this.deploymentTypes.removeAll(),e||t==o.ADBworkLoadType.AJD?this.setOnlySharedDeploymentType():this.setDefaultDeploymentTypes()}populateSupportedDatabaseVersionComboBox(e,t){this.databaseVersions.removeAll();let s=this.dbVersionListForWorkload.getSupportedDBVersionList(e,t);if(0==s.length)this.databaseVersions.push({value:this.createADBUILabelText.noDatabaseVersionAvailable,label:this.createADBUILabelText.noDatabaseVersionAvailable}),this.databaseVersion(this.createADBUILabelText.noDatabaseVersionAvailable);else{for(let e=0;e<s.length;e++)this.databaseVersions.push({value:s[e],label:s[e]});this.databaseVersion(s[0])}}onConfigChanged(e){const t=e.data;a.DataAccessService.instance.updatedConfig(t)}get messagesDataprovider(){return c.MessagesService.getinstance().messagesDataproviderField}getIPAddressList(e){let t=null;return e&&e.length>0&&(t=new Array,e.split(",").forEach(e=>{e&&e.trim().length>0&&t.push(e.trim())})),t}validIPAddress(e){let t=!0,s=this.getIPAddressList(e);if(s){if(0==s.length)return!0;let e=new RegExp("^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$");for(let a=0;a<s.length;a++)if(null==s[a].match(e)){t=!1;break}}return t}}}));