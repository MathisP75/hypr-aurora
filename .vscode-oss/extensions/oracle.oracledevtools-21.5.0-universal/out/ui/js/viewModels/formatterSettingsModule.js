define(["require","exports","knockout","../common/dataAccessService","../common/localizedConstants","../common/scriptExecutionModels","../utilities","../common/messageService","ojs/ojbutton","ojs/ojcheckboxset","ojs/ojknockout","ojs/ojinputtext","ojs/ojformlayout","ojs/ojlabel","ojs/ojselectcombobox","ojs/ojmessage","ojs/ojmessages","ojs/ojcollapsible","ojs/ojlistview","ojs/ojprogress","ojs/ojprogress-circle"],(function(require,e,t,n,s,a,i,o){"use strict";return class{constructor(e){this.msgPos={my:{vertical:"top",horizontal:"end"},at:{vertical:"top",horizontal:"end"},of:"window"},this.messageHandlersField=new Map,this.savedSettings=new a.FormatOptions,this.saveButtonDisable=t.observable(!0),this.isSaving=t.observable(!1),this.isFormatting=t.observable(!1),this.isExporting=t.observable(!1),this.isImporting=t.observable(!1),this.isPagePopulated=!1,this.textareaValue=t.observable("DECLARE\n\tvar_nam_1 NUMBER;\n\tvar_2     VARCHAR2;\n\tv3        custom_data_type;\nBEGIN\n /*sample comment*/\n\tNULL;\n --another sample comment\n\tproc1( );\n /*multi \n    line\n        comment */\n\tvar_2 := 1 * 4 - 9 + ( 33 );\n\tdbms_output.put_line( 'Name = '\n\t\t|| item.last_name\n\t\t|| ', Job = '\n\t\t|| item.job_id ); --cc\n\tdbms_lob.compare(\n\t\tlob_1 => p_,\n\t\tlob_2 => p_,\n\t\tamount => p_,\n\t\toffset_1 => p_,\n\t\toffset_2 => p_\n\t);\n\tdbms_output.put_line(\n\t\tCASE\n\t\t\tWHEN b IS NULL THEN\n\t\t\t\t'Unknown'\n\t\t\tWHEN b THEN\n\t\t\t\t'Yes'\n\t\t\tWHEN NOT b THEN\n\t\t\t\t'No'\n\t\tEND );\nEXCEPTION\n\tWHEN some_exception THEN\n\t\tdbms_output.put_line( 'some_exception' );\n\t\tdbms_output.put_line( 'additional_statement' );\n\tWHEN new_exception OR other_exception THEN\n\t\tdbms_output.put_line( 'new_exception' );\n\t\tdbms_output.put_line( 'additional_statement' );\n\tWHEN OTHERS THEN\n\t\tdbms_output.put_line( 'do nothing' );\n\t\tdbms_output.put_line( 'additional_statement' );\nEND;\n/\n\nSELECT\n\tcolumn_1      AS alias_1,\n\tcol2          a_2,\n\tc3            AS al_3,\n\tc4 || column5 AS ali_4\nFROM\n\tdepartments d,\n\temp         e\nWHERE\n\tsomething = something_else\n\t\tAND something_more = something_again\n\t\tAND something_else = something_more;\n\nSELECT\n\te.employee_id,\n\te.salary,\n\te.commission_pct\nFROM\n\temployees   e\n\tJOIN departments d\n\t\tUSING( department_id );"),this.selectedKeywordCasing=t.observable(a.Casing.SameAsIntellisense),this.selectedIdentifierCasing=t.observable(a.Casing.SameAsIntellisense),this.selectedLineCommentType=t.observable(a.SingleLineCommentFormatType.KeepUnchanged),this.selectedLineBrkBtwnStmts=t.observable(2),this.selectedLineBrkOnComma=t.observable(a.LineBreakPosition.After),this.selectedLineBrkOnConcat=t.observable(a.LineBreakPosition.Before),this.selectedLineBrkOnBoolConn=t.observable(a.LineBreakPosition.Before),this.enableANSIJoinLineBrk=t.observable(!0),this.enableLineBrkBeforeComment=t.observable(!1),this.enableLineBrkAfterSelect=t.observable(!0),this.selectedLineBrkOnIfCaseWhile=t.observable(a.IfCaseWhileFormatType.IndentedActionInlinedCondition),this.selectedwsAroundOper=t.observable(a.WhiteSpaceSetting.Default),this.enableWsAfterCommas=t.observable(!0),this.selectedWsAroundParen=t.observable(a.WhiteSpaceSetting.Default),this.casingTypes=t.observableArray([{value:a.Casing.SameAsIntellisense,label:s.LocalizedConstants.Instance.sameAsIntellisense},{value:a.Casing.Uppercase,label:s.LocalizedConstants.Instance.upperCase},{value:a.Casing.Lowercase,label:s.LocalizedConstants.Instance.lowerCase},{value:a.Casing.None,label:s.LocalizedConstants.Instance.noChange}]),this.singleLineCommentOptions=t.observableArray([{value:a.SingleLineCommentFormatType.KeepUnchanged,label:s.LocalizedConstants.Instance.keepUnchanged},{value:a.SingleLineCommentFormatType.WrapMultiline,label:s.LocalizedConstants.Instance.wrapMultiline},{value:a.SingleLineCommentFormatType.WrapSingleline,label:s.LocalizedConstants.Instance.wrapSingleLine}]),this.lineBrkBtwnStmtsOptions=t.observableArray([{value:2,label:s.LocalizedConstants.Instance.doubleBreak},{value:1,label:s.LocalizedConstants.Instance.singlebreak}]),this.lineBreakOptions=t.observableArray([{value:a.LineBreakPosition.After,label:s.LocalizedConstants.Instance.after},{value:a.LineBreakPosition.Before,label:s.LocalizedConstants.Instance.before},{value:a.LineBreakPosition.NoBreak,label:s.LocalizedConstants.Instance.noBreak}]),this.IfCaseWhilekOptions=t.observableArray([{value:a.IfCaseWhileFormatType.IndentedActionInlinedCondition,label:s.LocalizedConstants.Instance.indentedActionsInlinedConditions},{value:a.IfCaseWhileFormatType.Terse,label:s.LocalizedConstants.Instance.terse},{value:a.IfCaseWhileFormatType.LineBreaksAfterConditionAndAction,label:s.LocalizedConstants.Instance.lineBreakAfterConditionsAndActions},{value:a.IfCaseWhileFormatType.IndentedConditionAndAction,label:s.LocalizedConstants.Instance.indentedConditionsAndActions}]),this.wsAroundOperOptions=t.observableArray([{value:a.WhiteSpaceSetting.Default,label:s.LocalizedConstants.Instance.keepUnchanged},{value:a.WhiteSpaceSetting.AddSpace,label:s.LocalizedConstants.Instance.addSpace},{value:a.WhiteSpaceSetting.NoSpace,label:s.LocalizedConstants.Instance.noSpace}]),this.wsAroundParenOptions=t.observableArray([{value:a.WhiteSpaceSetting.Default,label:s.LocalizedConstants.Instance.keepUnchanged},{value:a.WhiteSpaceSetting.InsideBrackets,label:s.LocalizedConstants.Instance.inside},{value:a.WhiteSpaceSetting.OutsideBrackets,label:s.LocalizedConstants.Instance.outside},{value:a.WhiteSpaceSetting.NoSpace,label:s.LocalizedConstants.Instance.noSpace}]),this.yesNoOptions=t.observableArray([{value:!0,label:s.LocalizedConstants.Instance.yes},{value:!1,label:s.LocalizedConstants.Instance.no}]),this.onValueChanged=()=>{!this.isPagePopulated||this.selectedIdentifierCasing()==this.savedSettings.identifierCasing&&this.selectedKeywordCasing()==this.savedSettings.keywordCasing&&this.selectedLineCommentType()==this.savedSettings.singleLineComments&&this.selectedLineBrkBtwnStmts()==this.savedSettings.lineBrkBtwnStmts&&this.selectedLineBrkOnComma()==this.savedSettings.lineBreakOnComma&&this.selectedLineBrkOnConcat()==this.savedSettings.lineBreakOnConcat&&this.selectedLineBrkOnBoolConn()==this.savedSettings.lineBreakOnBooleanConn&&this.enableANSIJoinLineBrk()==this.savedSettings.lineBreakOnANSIJoins&&this.enableLineBrkBeforeComment()==this.savedSettings.lineBreakBeforeLineComments&&this.enableLineBrkAfterSelect()==this.savedSettings.lineBreakAfterSelectFromWhere&&this.selectedLineBrkOnIfCaseWhile()==this.savedSettings.lineBreakForIfCaseWhile&&this.selectedwsAroundOper()==this.savedSettings.wsAroundOperators&&this.selectedWsAroundParen()==this.savedSettings.wsAroundParenthesis&&this.enableWsAfterCommas()==this.savedSettings.wsAfterCommas?this.saveButtonDisable(!0):this.saveButtonDisable(!1)},this.onThemeChanged=()=>{n.DataAccessService.instance.logInfo("Theme Changed"),i.setContrast()},this.onPreview=()=>{n.DataAccessService.instance.logInfo("Sending formatting request from UI ...");const e=new a.FormatPreviewTextRequest,t=new a.MessageBase;t.type=a.MessageName.formatPreviewTextRequest,e.executionId=n.DataAccessService.instance.currentExecutionId,e.ownerUri=n.DataAccessService.instance.URI,e.windowUri=n.DataAccessService.instance.windowUri,e.text=this.textareaValue(),e.formatConfig=this.getActiveSettings(),t.data=e;try{n.DataAccessService.instance.send(t),this.isFormatting(!0),n.DataAccessService.instance.logInfo("Successfully placed format request for preview text")}catch(e){n.DataAccessService.instance.logError(e)}},this.onSaveSettings=()=>{n.DataAccessService.instance.logInfo("Saving formatter settings ..."),this.isSaving(!0),this.saveButtonDisable(!0);const e=new a.SaveFormatterSettingsRequest,t=new a.MessageBase;t.type=a.MessageName.saveFormatterSettingsRequest,e.executionId=n.DataAccessService.instance.currentExecutionId,e.ownerUri=n.DataAccessService.instance.URI,e.windowUri=n.DataAccessService.instance.windowUri,e.formatConfig=this.getActiveSettings(),t.data=e;try{n.DataAccessService.instance.send(t),n.DataAccessService.instance.logInfo("Successfully placed save formatter settings request ")}catch(e){n.DataAccessService.instance.logError(e)}},this.onReset=()=>{let e=new a.FormatOptions;e.identifierCasing=a.Casing.SameAsIntellisense,e.keywordCasing=a.Casing.SameAsIntellisense,e.singleLineComments=a.SingleLineCommentFormatType.KeepUnchanged,e.lineBrkBtwnStmts=2,e.lineBreakOnComma=a.LineBreakPosition.After,e.lineBreakOnConcat=a.LineBreakPosition.Before,e.lineBreakOnBooleanConn=a.LineBreakPosition.Before,e.lineBreakOnANSIJoins=!0,e.lineBreakBeforeLineComments=!1,e.lineBreakAfterSelectFromWhere=!0,e.lineBreakForIfCaseWhile=a.IfCaseWhileFormatType.IndentedActionInlinedCondition,e.wsAroundOperators=a.WhiteSpaceSetting.Default,e.wsAfterCommas=!0,e.wsAroundParenthesis=a.WhiteSpaceSetting.Default,this.initConfigValues(e),this.onValueChanged()},this.onExport=()=>{const e=new a.ExportFormatSettingsRequest,t=new a.MessageBase;t.type=a.MessageName.exportFormatSettingsRequest,e.executionId=n.DataAccessService.instance.currentExecutionId,e.ownerUri=n.DataAccessService.instance.URI,e.windowUri=n.DataAccessService.instance.windowUri,e.formatConfig=this.getActiveSettings(),t.data=e;try{n.DataAccessService.instance.send(t),n.DataAccessService.instance.logInfo("Successfully placed export formatter settings request "),this.isExporting(!0)}catch(e){n.DataAccessService.instance.logError(e)}},this.onImport=()=>{const e=new a.ImportFormatSettingsRequest,t=new a.MessageBase;t.type=a.MessageName.importFormatSettingsRequest,e.executionId=n.DataAccessService.instance.currentExecutionId,e.ownerUri=n.DataAccessService.instance.URI,e.windowUri=n.DataAccessService.instance.windowUri,t.data=e;try{n.DataAccessService.instance.send(t),n.DataAccessService.instance.logInfo("Successfully placed import formatter settings request "),this.isImporting(!0)}catch(e){n.DataAccessService.instance.logError(e)}},this.moduleName=e.moduleName,this.messageHandlers.set(a.MessageName.themeChanged,this.onThemeChanged),this.messageHandlers.set(a.MessageName.odtConfigChanged,this.onConfigChanged),this.messageHandlers.set(a.MessageName.getFormatterSettingsResponse,e=>{this.handleGetFormatterSettingsResponse(e)}),this.messageHandlers.set(a.MessageName.saveFormatterSettingsResponse,e=>{this.handleSaveFormatterSettingsResponse(e)}),this.messageHandlers.set(a.MessageName.formatPreviewTextResponse,e=>{this.handleFormatPreviewTextResponse(e)}),this.messageHandlers.set(a.MessageName.importFormatSettingsResponse,e=>{this.handleImportFormatterSettingsResponse(e)}),this.messageHandlers.set(a.MessageName.exportFormatSettingsResponse,e=>{this.handleExportFormatterSettingsResponse(e)}),n.DataAccessService.instance.subscribe(e=>{if(e&&this.messageHandlers.get(e.type)){const t=this.messageHandlers.get(e.type);t&&t(e)}else n.DataAccessService.instance.logError("Could not find handler for message "+e.type)}),n.DataAccessService.instance.logInfo("Fetching Localized resources "),n.DataAccessService.instance.getLocalizedData().done(e=>{n.DataAccessService.instance.logInfo("Fetched localized resources."),s.LocalizedConstants.Instance.Configure(e)}).fail(e=>{n.DataAccessService.instance.logError("Localized resources "+JSON.stringify(e))}),this.initialize(),i.setContrast()}get messagesDataprovider(){return o.MessagesService.getinstance().messagesDataproviderField}get previewLabel(){return s.LocalizedConstants.Instance.preview}get formatterSettingsTitle(){return s.LocalizedConstants.Instance.formatterSettingsTitle}get formatterSettingsSubTitle(){return s.LocalizedConstants.Instance.formatterSettingsSubtitle}get keywordCaseLabel(){return s.LocalizedConstants.Instance.keywordCasingLabel}get identifierCaseLabel(){return s.LocalizedConstants.Instance.identifierCasingLabel}get singleLingeCommentLabel(){return s.LocalizedConstants.Instance.singleLineCommentLabel}get lineBrkBtwnStmtsLabel(){return s.LocalizedConstants.Instance.lineBrkBtwnStmtsLabel}get lineBrkonCommaLabel(){return s.LocalizedConstants.Instance.lineBrkOnCommaLabel}get lineBrkonConcatLabel(){return s.LocalizedConstants.Instance.lineBreakOnConcatLabel}get lineBrkonBoolConnLabel(){return s.LocalizedConstants.Instance.lineBreakOnBoolConnLabel}get lineBrkonANSIJoinsLabel(){return s.LocalizedConstants.Instance.lineBreakOnANSIJoinLabel}get lineBrkBeforeLineCommentLabel(){return s.LocalizedConstants.Instance.lineBreakBeforeLineCommentLabel}get lineBrkAfterSelectFromWhereLabel(){return s.LocalizedConstants.Instance.lineBreakAfterSelectLabel}get lineBrkonIfCaseWhileLabel(){return s.LocalizedConstants.Instance.lineBreakOnIFCaseLabel}get wsAroundOperLabel(){return s.LocalizedConstants.Instance.wsOnOperLabel}get wsAfterCommasLabel(){return s.LocalizedConstants.Instance.wsOnCommaLabel}get wsAroundParenLabel(){return s.LocalizedConstants.Instance.wsAroundParenLabel}get saveLabel(){return s.LocalizedConstants.Instance.saveBtnLabel}get resetToDefaults(){return s.LocalizedConstants.Instance.resetToDefaults}get exportSettings(){return s.LocalizedConstants.Instance.exportSettings}get importSettings(){return s.LocalizedConstants.Instance.importSettings}get messageHandlers(){return this.messageHandlersField}set messageHandlers(e){this.messageHandlersField=e}initialize(){n.DataAccessService.instance.logInfo("Start initializing formatterSettingsModule"),o.MessagesService.getinstance().ClearAll();const e=new a.MessageBase;e.type=a.MessageName.getFormatterSettingsRequest;const t=new a.GetFormatterSettingsRequest;t.executionId=n.DataAccessService.instance.currentExecutionId,t.ownerUri=n.DataAccessService.instance.URI,t.windowUri=n.DataAccessService.instance.windowUri,e.data=t;try{n.DataAccessService.instance.send(e),n.DataAccessService.instance.logInfo("Successfully placed get formatter settings request ")}catch(e){n.DataAccessService.instance.logError(e)}n.DataAccessService.instance.logInfo("End initializing")}onConfigChanged(e){const t=e.data;n.DataAccessService.instance.updatedConfig(t)}initConfigValues(e){void 0!==e.identifierCasing&&this.selectedIdentifierCasing(e.identifierCasing),void 0!==e.keywordCasing&&this.selectedKeywordCasing(e.keywordCasing),void 0!==e.singleLineComments&&this.selectedLineCommentType(e.singleLineComments),void 0!==e.lineBrkBtwnStmts&&this.selectedLineBrkBtwnStmts(e.lineBrkBtwnStmts),void 0!==e.lineBreakOnComma&&this.selectedLineBrkOnComma(e.lineBreakOnComma),void 0!==e.lineBreakOnConcat&&this.selectedLineBrkOnConcat(e.lineBreakOnConcat),void 0!==e.lineBreakOnBooleanConn&&this.selectedLineBrkOnBoolConn(e.lineBreakOnBooleanConn),void 0!==e.lineBreakOnANSIJoins&&this.enableANSIJoinLineBrk(e.lineBreakOnANSIJoins),void 0!==e.lineBreakBeforeLineComments&&this.enableLineBrkBeforeComment(e.lineBreakBeforeLineComments),void 0!==e.lineBreakAfterSelectFromWhere&&this.enableLineBrkAfterSelect(e.lineBreakAfterSelectFromWhere),void 0!==e.lineBreakForIfCaseWhile&&this.selectedLineBrkOnIfCaseWhile(e.lineBreakForIfCaseWhile),void 0!==e.wsAroundOperators&&this.selectedwsAroundOper(e.wsAroundOperators),void 0!==e.wsAroundParenthesis&&this.selectedWsAroundParen(e.wsAroundParenthesis),void 0!==e.wsAfterCommas&&this.enableWsAfterCommas(e.wsAfterCommas)}getActiveSettings(){let e=new a.FormatOptions;try{e.identifierCasing=this.selectedIdentifierCasing(),e.keywordCasing=this.selectedKeywordCasing(),e.singleLineComments=this.selectedLineCommentType(),e.lineBrkBtwnStmts=this.selectedLineBrkBtwnStmts(),e.lineBreakOnComma=this.selectedLineBrkOnComma(),e.lineBreakOnConcat=this.selectedLineBrkOnConcat(),e.lineBreakOnBooleanConn=this.selectedLineBrkOnBoolConn(),e.lineBreakOnANSIJoins=this.enableANSIJoinLineBrk(),e.lineBreakBeforeLineComments=this.enableLineBrkBeforeComment(),e.lineBreakAfterSelectFromWhere=this.enableLineBrkAfterSelect(),e.lineBreakForIfCaseWhile=this.selectedLineBrkOnIfCaseWhile(),e.wsAroundOperators=this.selectedwsAroundOper(),e.wsAfterCommas=this.enableWsAfterCommas(),e.wsAroundParenthesis=this.selectedWsAroundParen()}catch(e){n.DataAccessService.instance.logError(e)}return e}handleExportFormatterSettingsResponse(e){n.DataAccessService.instance.logInfo("Received ExportFormatSettingsResponse");try{const t=e.data;n.DataAccessService.instance.logInfo(t.resultMsg)}catch(e){n.DataAccessService.instance.logError(e)}finally{this.isExporting(!1)}}handleImportFormatterSettingsResponse(e){n.DataAccessService.instance.logInfo("Received SaveFormatterSettingsResponse");try{const t=e.data;t.formatConfig&&(this.initConfigValues(t.formatConfig),this.onValueChanged()),t.resultMsg&&(o.MessagesService.getinstance().ClearAll(),o.MessagesService.getinstance().ShowMessage(t.resultMsg),n.DataAccessService.instance.logInfo(t.resultMsg))}catch(e){n.DataAccessService.instance.logError(e)}finally{this.isImporting(!1)}}handleSaveFormatterSettingsResponse(e){n.DataAccessService.instance.logInfo("Received SaveFormatterSettingsResponse");try{const t=e.data;t&&(o.MessagesService.getinstance().ClearAll(),o.MessagesService.getinstance().ShowMessage(t.message),t.success?this.savedSettings=this.getActiveSettings():this.saveButtonDisable(!1))}catch(e){n.DataAccessService.instance.logError(e),this.saveButtonDisable(!1)}finally{this.isSaving(!1)}}handleGetFormatterSettingsResponse(e){n.DataAccessService.instance.logInfo("Received GetFormatterSettingsResponse");try{const t=e.data;this.savedSettings=t.formatConfig,this.initConfigValues(t.formatConfig),this.isPagePopulated=!0,this.onPreview()}catch(e){n.DataAccessService.instance.logError(e)}}handleFormatPreviewTextResponse(e){n.DataAccessService.instance.logInfo("Received FormatPreviewTextResponse");try{const t=e.data;t&&t.formattedText&&this.textareaValue(t.formattedText),n.DataAccessService.instance.logInfo("FormatPreviewTextResponse processed")}catch(e){n.DataAccessService.instance.logError(e)}this.isFormatting(!1)}}}));