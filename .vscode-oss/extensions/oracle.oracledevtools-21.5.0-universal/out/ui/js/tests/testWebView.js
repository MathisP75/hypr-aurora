define(["require","exports","../common/scriptExecutionModels","../common/dataAccessService","ojs/ojkeyset"],(function(require,e,t,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TestWebView=void 0;e.TestWebView=class{constructor(){window.addEventListener("message",e=>{const t=e.data;switch(t.command){case"getobjects":this.getItemsInView(t);break;case"setobjects":this.setAndSubmitItemsInView(t);break;case"getHtml":this.getHtml(t);break;case"setDataGrid":this.setDataGrid(t)}})}getItemsInView(e){try{var s="",a=new Map;if(null==e.args||""==e.args){var i=$("html").html();s=JSON.stringify(i)}else{var r=JSON.parse(e.args);r[Object.keys(r)[0]].forEach((function(e){var t;let n=e.id;if(e.id)t=document.getElementById(e.id);else if(e.class){let s=document.getElementsByClassName(e.class),a=e.index?e.index+1:0;s&&s.length>0&&(t=s[a]),n=e.class}var s=$(t).prop("value");if(null!=s)a[n]=s;else if("OJ-TREE-VIEW"==t.nodeName){let s,i=t.getElementsByClassName("oj-treeview-item");if("true"==e.selected){let e=t.getProperty("selected");for(let r=0;r<i.length;r++)if(s=t.getContextByNode(i[r]),e.has(s.key)){a[n]=s.data.name;break}}else{a[n]=[];for(let e=0;e<i.length;e++)s=t.getContextByNode(i[e]),null==s.parentKey&&a[n].push(s.data)}}else a[n]=t.innerText})),s=JSON.stringify(a)}var o=new t.TestCommandResponse("showdata",s);n.DataAccessService.instance.sendTestCommandResponse(o)}catch(e){n.DataAccessService.instance.logError(e)}}setAndSubmitItemsInView(e){try{if(null==e.args||""==e.args)return;var t=JSON.parse(e.args);if(null!=t.items&&t[Object.keys(t)[0]].forEach((function(e){var t=document.getElementById(e.id);let n=Object.keys(e)[1];t.getAttribute(n)!=e[n]&&(t.focus(),$(t).prop(n,e[n]))})),null!=t.commandButton){var a=document.getElementById(t.commandButton.id);"true"==t.commandButton.forceEnable&&$(a).prop("disabled",!1),document.getElementById(t.commandButton.id).click()}if(null!=t.event)if("enterKey"==t.event.name)document.getElementById(t.event.id).dispatchEvent(new KeyboardEvent("keydown",{key:"Enter"}));else if("select"==t.event.name){let e=document.getElementById(t.event.id);if(e&&"OJ-MENU"===e.nodeName){let n=document.getElementById(t.event.itemName),s=e,a=new CustomEvent("ojMenuAction",{detail:{selectedValue:n.value}});s.dispatchEvent(a)}else{let n,a=e,i=a.getElementsByClassName("oj-treeview-item");for(let e=0;e<i.length;e++)if(n=a.getContextByNode(i[e]),n.data.name==t.event.itemName){a.setProperty("selected",new s.KeySetImpl([n.key]));break}}}else if("expand"==t.event.name){let e,n=document.getElementById(t.event.id),s=n.getElementsByClassName("oj-treeview-item");for(let a=0;a<s.length;a++)if(e=n.getContextByNode(s[a]),e.data.name==t.event.itemName){let t=n.getProperty("expanded").add([e.key]);n.setProperty("expanded",t);break}}else"focus"==t.event.name&&document.getElementById(t.event.id).focus()}catch(e){n.DataAccessService.instance.logError(e)}}setDataGrid(e){try{var t=JSON.parse(e.args);if(null!=t.item){var s=document.getElementById(t.item.id);let e=Object.keys(t.item)[1];s[e]=t.item[e]}if(null!=t.editRow)document.getElementById(t.editRow.tableId).setProperty("editRow",{rowIndex:t.editRow.rowIndex})}catch(e){n.DataAccessService.instance.logError(e)}}getHtml(e){try{var s=JSON.parse(e.args),a="";null!=s.item&&(a=document.getElementById(s.item.id).innerHTML);var i=new t.TestCommandResponse("showdata",a);n.DataAccessService.instance.sendTestCommandResponse(i)}catch(e){n.DataAccessService.instance.logError(e)}}}}));